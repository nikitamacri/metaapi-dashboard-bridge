'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _metaApi = require('../metaApi.client');

var _metaApi2 = _interopRequireDefault(_metaApi);

var _timeoutError = require('../timeoutError');

var _timeoutError2 = _interopRequireDefault(_timeoutError);

var _randomstring = require('randomstring');

var _randomstring2 = _interopRequireDefault(_randomstring);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * metaapi.cloud CopyFactory configuration API (trade copying configuration API) client (see
 * https://metaapi.cloud/docs/copyfactory/)
 */
class ConfigurationClient extends _metaApi2.default {

  /**
   * Constructs CopyFactory configuration API client instance
   * @param {HttpClient} httpClient HTTP client
   * @param {String} token authorization token
   * @param {String} domain domain to connect to, default is agiliumtrade.agiliumtrade.ai
   */
  constructor(httpClient, token, domain = 'agiliumtrade.agiliumtrade.ai') {
    super(httpClient, token, domain);
    this._host = `https://trading-api-v1.${domain}`;
  }

  /**
   * Strategy id
   * @typedef {Object} StrategyId
   * @property {String} id strategy id
   */

  /**
   * Retrieves new unused strategy id. Method is accessible only with API access token. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/generateStrategyId/
   * @return {Promise<StrategyId>} promise resolving with strategy id generated
   */
  generateStrategyId() {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('generateStrategyId');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/unused-strategy-id`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Generates random account id
   * @return {String} account id
   */
  generateAccountId() {
    return _randomstring2.default.generate(64);
  }

  /**
   * CopyFactory account model
   * @typedef {CopyFactoryAccountUpdate} CopyFactoryAccount
   * @property {String} _id account unique identifier
   */

  /**
   * CopyFactory strategy subscriptions
   * @typedef {Object} CopyFactoryStrategySubscription
   * @property {String} strategyId id of the strategy to subscribe to
   * @property {Number} [multiplier] optional subscription multiplier, default is 1x
   * @property {Boolean} [skipPendingOrders] optional flag indicating that pending orders should not be copied. Default
   * is to copy pending orders
   * @property {String} [closeOnly] optional setting wich instructs the application not to open new positions. by-symbol
   * means that it is still allowed to open new positions with a symbol equal to the symbol of an existing strategy
   * position (can be used to gracefuly exit strategies trading in netting mode or placing a series of related trades
   * per symbol). One of by-position, by-symbol or leave empty to disable this setting.
   * @property {Number} [maxTradeRisk] optional max risk per trade, expressed as a fraction of 1. If trade has a SL, the
   * trade size will be adjusted to match the risk limit. If not, the trade SL will be applied according to the risk
   * limit
   * @property {Boolean} [reverse] flag indicating that the strategy should be copied in a reverse direction
   * @property {String} [reduceCorrelations] optional setting indicating whether to enable automatic trade correlation
   * reduction. Possible settings are not specified (disable correlation risk restrictions), by-strategy (limit
   * correlations for the strategy) or by-account (limit correlations for the account)
   * @property {CopyFactoryStrategyStopOut} [stopOutRisk] optional stop out setting. All trading will be terminated and positions closed
   * once equity drawdown reaches this value
   * @property {CopyFactoryStrategySymbolFilter} [symbolFilter] optional symbol filter which can be used to copy only specific
   * symbols or exclude some symbols from copying
   * @property {CopyFactoryStrategyNewsFilter} [newsFilter] optional news risk filter configuration
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] optional strategy risk limits. You can configure trading to be
   * stopped once total drawdown generated during specific period is exceeded. Can be specified either for balance or
   * equity drawdown
   * @property {CopyFactoryStrategyMaxStopLoss} [maxStopLoss] optional stop loss value restriction
   * @property {Number} [maxLeverage] optional setting indicating maximum leverage allowed when opening a new positions.
   * Any trade which results in a higher leverage will be discarded
   * @property {Array<CopyFactoryStrategySymbolMapping>} [symbolMapping] defines how symbol name should be changed when
   * trading (e.g. when broker uses symbol names with unusual suffixes). By default this setting is disabled and the
   * trades are copied using signal source symbol name
   * @property {CopyFactoryStrategyTradeSizeAcaling} [tradeSizeScaling] Trade size scaling settings. By default the
   * trade size on strategy subscriber side will be scaled according to balance to preserve risk.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   */

  /**
   * CopyFactory strategy trade size scaling settings
   * @typedef {Object} CopyFactoryStrategyTradeSizeScaling
   * @property {string} mode If set to balance, the trade size on strategy subscriber will be scaled according to
   * balance to preserve risk. If value is none, then trade size will be preserved irregardless of the subscriber
   * balance. If value is contractSize, then trade size will be scaled according to contract size. If fixedVolume is
   * set, then trade will be copied with a fixed volume of traceVolume setting. If fixedRisk is set, then each trade
   * will be copied with a trade volume set to risk specific fraction of balance as configured by riskFraction setting.
   * Note, that in fixedRisk mode trades without a SL are not copied. Default is balance. Allowed values: none,
   * contractSize, balance, fixedVolume, fixedRisk
   * @property {number} [tradeVolume] Fixed trade volume for use with fixedVolume trade size scaling mode
   * @property {number} [riskFraction] Fixed risk fraction for use with fixedRisk trade size scaling mode
   */

  /**
   * CopyFactory strategy stopout settings
   * @typedef {Object} CopyFactoryStrategyStopOut
   * @property {Number} value value of the stop out risk, expressed as a fraction of 1
   * @property {Date} [startTime] the time to start risk calculation from. All previous trades will be ignored. You can
   * use it to reset the risk counter after a stopout event
   */

  /**
   * CopyFactory symbol filter
   * @typedef {Object} CopyFactoryStrategySymbolFilter
   * @property {Array<String>} included list of symbols copied. Leave the value empty to copy all symbols
   * @property {Array<String>} excluded list of symbols excluded from copying. Leave the value empty to copy all symbols
   */

  /**
   * CopyFactory news risk filter
   * @typedef {Object} CopyFactoryStrategyNewsFilter
   * @property {CopyFactoryStrategyBreakingNewsFilter} [breakingNewsFilter] optional breaking news filter
   * @property {CopyFactoryStrategyCalendarNewsFilter} [calendarNewsFilter] optional calendar news filter
   */

  /**
   * CopyFactory breaking news risk filter
   * @typedef {Object} CopyFactoryStrategyBreakingNewsFilter
   * @property {Array<String>} priorities list of breaking news priorities to stop trading on, leave empty to disable
   * breaking news filter. One of high, medium, low.
   * @property {Number} [closePositionTimeGapInMinutes] optional time interval specifying when to force close an already
   * open position after breaking news. Default value is 60 minutes
   * @property {Number} [openPositionFollowingTimeGapInMinutes] optional time interval specifying when it is allowed to
   * open position after calendar news. Default value is 60 minutes
   */

  /**
   * CopyFactory calendar new filter
   * @typedef {Object} CopyFactoryStrategyCalendarNewsFilter
   * @property {Array<String>} priorities list of calendar news priorities to stop trading on, leave empty to disable
   * calendar news filter. One of election, high, medium, low.
   * @property {Number} [closePositionTimeGapInMinutes] optional time interval specifying when to force close an already
   * open position before calendar news. Default value is 60 minutes
   * @property {Number} [openPositionPrecedingTimeGapInMinutes] optional time interval specifying when it is still
   * allowed to open position before calendar news. Default value is 120 minutes
   * @property {Number} [openPositionFollowingTimeGapInMinutes] optional time interval specifying when it is allowed to
   * open position after calendar news. Default value is 60 minutes
   */

  /**
   * CopyFactory risk limit filter
   * @typedef {Object} CopyFactoryStrategyRiskLimit
   * @property {String} type restriction type. One of daily, monthly, or yearly
   * @property {String} applyTo account metric to apply limit to. One of balance, equity
   * @property {Number} maxRisk max drawdown allowed, expressed as a fraction of 1
   * @property {Boolean} closePositions whether to force close positions when the risk is reached. If value is false
   * then only the new trades will be halted, but existing ones will not be closed
   * @property {Date} [startTime] optional time to start risk tracking from. All previous trades will be ignored. You
   * can use this value to reset the filter after stopout event
   */

  /**
   * CopyFactory strategy max stop loss settings
   * @typedef {Object} CopyFactoryStrategyMaxStopLoss
   * @property {Number} value maximum SL value
   * @property {String} units SL units. Only pips value is supported at this point
   */

  /**
   * CopyFactory strategy symbol mapping
   * @typedef {Object} CopyFactoryStrategySymbolMapping
   * @property {String} from symbol name to convert from
   * @property {String} to symbol name to convert to
   */

  /**
   * Retrieves CopyFactory copy trading accounts. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getAccounts/
   * @return {Promise<Array<CopyFactoryAccount>>} promise resolving with CopyFactory accounts found
   */
  getAccounts() {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getAccounts');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/accounts`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Retrieves CopyFactory copy trading account by id. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getAccount/
   * @param {string} accountId CopyFactory account id
   * @return {Promise<CopyFactoryAccount>} promise resolving with CopyFactory account found
   */
  getAccount(accountId) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getAccount');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/accounts/${accountId}`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * CopyFactory account update
   * @typedef {Object} CopyFactoryAccountUpdate
   * @property {String} name account human-readable name
   * @property {String} connectionId id of the MetaApi MetaTrader account this copy trading account is connected to
   * @property {Number} [reservedMarginFraction] optional fraction of reserved margin to reduce a risk of margin call.
   * Default is to reserve no margin. We recommend using maxLeverage setting instead. Specified as a fraction of balance
   * thus the value is usually greater than 1
   * @property {Array<String>} [phoneNumbers] optional phone numbers to send sms notifications to. Leave empty to
   * receive no sms notifications
   * @property {Number} [minTradeAmount] optional value of minimal trade size allowed, expressed in amount of account
   * currency. Can be useful if your broker charges a fixed fee per transaction so that you can skip small trades with
   * high broker commission rates. Default is 100
   * @property {String} [closeOnly] optional setting wich instructs the application not to open new positions. by-symbol
   * means that it is still allowed to open new positions with a symbol equal to the symbol of an existing strategy
   * position (can be used to gracefuly exit strategies trading in netting mode or placing a series of related trades
   * per symbol). One of by-position, by-symbol or leave empty to disable this setting.
   * @property {CopyFactoryStrategyStopOut} [stopOutRisk] optional stop out setting. All trading will be terminated and positions closed
   * once equity drawdown reaches this value
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] optional account risk limits. You can configure trading to be
   * stopped once total drawdown generated during specific period is exceeded. Can be specified either for balance or
   * equity drawdown
   * @property {Number} [maxLeverage] optional setting indicating maxumum leverage allowed when opening a new positions.
   * Any trade which results in a higher leverage will be discarded.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   * @property {Array<CopyFactoryStrategySubscription>} subscriptions strategy subscriptions
   */

  /**
   * Updates a CopyFactory trade copying account. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/updateAccount/
   * @param {String} id copy trading account id
   * @param {CopyFactoryAccountUpdate} account trading account update
   * @return {Promise} promise resolving when account is updated
   */
  updateAccount(id, account) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('updateAccount');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/accounts/${id}`,
      method: 'PUT',
      headers: {
        'auth-token': this._token
      },
      body: account,
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Deletes a CopyFactory trade copying account. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/removeAccount/
   * @param {String} id copy trading account id
   * @return {Promise} promise resolving when account is removed
   */
  removeAccount(id) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('removeAccount');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/accounts/${id}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * CopyFactory provider strategy
   * @typedef {CopyFactoryStrategyUpdate} CopyFactoryStrategy
   * @property {String} _id unique strategy id
   * @property {Number} platformCommissionRate commission rate the platform charges for strategy copying, applied to
   * commissions charged by provider. This commission applies only to accounts not managed directly by provider. Should
   * be fraction of 1
   */

  /**
   * CopyFactory strategy commission scheme
   * @typedef {Object} CopyFactoryStrategyCommissionScheme
   * @property {String} type commission type. One of flat-fee, lots-traded, lots-won, amount-traded, amount-won,
   * high-water-mark
   * @property {String} billingPeriod billing period. One of week, month, quarter
   * @property {Number} commissionRate commission rate. Should be greater than or equal to zero if commission type is
   * flat-fee, lots-traded or lots-won, should be greater than or equal to zero and less than or equal to 1 if
   * commission type is amount-traded, amount-won, high-water-mark.
   */

  /**
   * CopyFactory strategy magic filter
   * @typedef {Object} CopyFactoryStrategyMagicFilter
   * @property {Array<String>} included list of magics (expert ids) or magic ranges copied. Leave the value empty to
   * copy all magics
   * @property {Array<String>} excluded list of magics (expert ids) or magic ranges excluded from copying. Leave the
   * value empty to copy all magics
   */

  /**
   * CopyFactory strategy time settings
   * @typedef {Object} CopyFactoryStrategyTimeSettings
   * @property {Number} [lifetimeInHours] optional position lifetime. Default is to keep positions open up to 90 days
   * @property {Number} [openingIntervalInMinutes] optional time interval to copy new positions. Default is to let 1
   * minute for the position to get copied. If position were not copied during this time, the copying will not be
   * retried anymore.
   */

  /**
   * CopyFactory strategy equity curve filter
   * @typedef {Object} CopyFactoryStrategyEquityCurveFilter
   * @property {Number} period moving average period, must be greater or equal to 1
   * @property {String} granularity moving average granularity, a positive integer followed by time unit, e.g. 2h.
   * Allowed units are s, m, h, d and w.
   */

  /**
   * CopyFactory strategy drawdown filter
   * @typedef {Object} CopyFactoryStrategyDrawdownFilter
   * @property {Number} maxDrawdown Maximum drawdown value after which action is executed. Drawdown should be configured
   * as a fraction of 1, i.e. 0.15 means 15% drawdown value
   * @property {String} action Action to take when drawdown exceeds maxDrawdown value. include means the trading signal
   * will be transmitted only if dd is greater than maxDrawdown value. exclude means the trading signal will be
   * transmitted only if dd is less than maxDrawdown value.
   */

  /**
   * Retrieves CopyFactory copy trading strategies. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getStrategies/
   * @return {Promise<Array<CopyFactoryStrategy>>} promise resolving with CopyFactory strategies found
   */
  getStrategies() {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getStrategies');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/strategies`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Retrieves CopyFactory copy trading strategy by id. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getStrategy/
   * @param {string} strategy id trading strategy id
   * @return {Promise<CopyFactoryStrategy>} promise resolving with CopyFactory strategy found
   */
  getStrategy(strategyId) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getStrategy');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/strategies/${strategyId}`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * CopyFactory strategy update
   * @typedef {Object} CopyFactoryStrategyUpdate
   * @property {String} name strategy human-readable name
   * @property {String} description longer strategy human-readable description
   * @property {String} positionLifecycle position detection mode. Allowed values are netting (single position per
   * strategy per symbol), hedging (multiple positions per strategy per symbol)
   * @property {String} connectionId id of the MetaApi account providing the strategy
   * @property {Boolean} [skipPendingOrders] optional flag indicating that pending orders should not be copied.
   * Default is to copy pending orders
   * @property {CopyFactoryStrategyCommissionScheme} [commissionScheme] commission scheme allowed by this strategy
   * @property {Number} [maxTradeRisk] optional max risk per trade, expressed as a fraction of 1. If trade has a SL, the
   * trade size will be adjusted to match the risk limit. If not, the trade SL will be applied according to the risk
   * limit
   * @property {Boolean} [reverse] flag indicating that the strategy should be copied in a reverse direction
   * @property {String} [reduceCorrelations] optional setting indicating whether to enable automatic trade correlation
   * reduction. Possible settings are not specified (disable correlation risk restrictions), by-strategy (limit
   * correlations for the strategy) or by-account (limit correlations for the account)
   * @property {CopyFactoryStrategyStopOut} [stopOutRisk] optional stop out setting. All trading will be terminated and
   * positions closed once equity drawdown reaches this value
   * @property {CopyFactoryStrategySymbolFilter} [symbolFilter] symbol filters which can be used to copy only specific
   * symbols or exclude some symbols from copying
   * @property {CopyFactoryStrategyNewsFilter} [newsFilter] news risk filter configuration
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] optional strategy risk limits. You can configure
   * trading to be stopped once total drawdown generated during specific period is exceeded. Can be specified either for
   * balance or equity drawdown
   * @property {CopyFactoryStrategyMaxStopLoss} [maxStopLoss] optional stop loss value restriction
   * @property {Number} [maxLeverage] optional max leverage risk restriction. All trades resulting in a leverage value
   * higher than specified will be skipped
   * @property {CopyFactoryStrategyMagicFilter} [magicFilter] optional magic (expert id) filter
   * @property {CopyFactoryStrategyTimeSettings} [timeSettings] settings to manage copying timeframe and position
   * lifetime. Default is to copy position within 1 minute from being opened at source and let the position to live for
   * up to 90 days
   * @property {Array<CopyFactoryStrategySymbolMapping>} [symbolMapping] defines how symbol name should be changed when
   * trading (e.g. when broker uses symbol names with unusual suffixes). By default this setting is disabled and the
   * trades are copied using signal source symbol name
   * @property {CopyFactoryStrategyTradeSizeAcaling} [tradeSizeScaling] Trade size scaling settings. By default the
   * trade size on strategy subscriber side will be scaled according to balance to preserve risk.
   * @property {CopyFactoryStrategyEquityCurveFilter} [equityCurveFilter] filter which permits the trades only if account
   * equity is greater than balance moving average
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   * @property {CopyFactoryStrategyDrawdownFilter} [drawdownFilter] Master account strategy drawdown filter
   */

  /**
   * Updates a CopyFactory strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/updateStrategy/
   * @param {String} id copy trading strategy id
   * @param {CopyFactoryStrategyUpdate} strategy trading strategy update
   * @return {Promise} promise resolving when strategy is updated
   */
  updateStrategy(id, strategy) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('updateStrategy');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/strategies/${id}`,
      method: 'PUT',
      headers: {
        'auth-token': this._token
      },
      body: strategy,
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Deletes a CopyFactory strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/removeStrategy/
   * @param {String} id strategy id
   * @return {Promise} promise resolving when strategy is removed
   */
  removeStrategy(id) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('removeStrategy');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/strategies/${id}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Portfolio strategy member
   * @typedef {Object} CopyFactoryPortfolioMember
   * @property {String} strategyId member strategy id
   * @property {Number} multiplier copying multiplier (weight in the portfolio)
   * @property {Boolean} [skipPendingOrders] optional flag indicating that pending orders should not be copied.
   * Default is to copy pending orders
   * @property {Number} [maxTradeRisk] optional max risk per trade, expressed as a fraction of 1. If trade has a SL, the
   * trade size will be adjusted to match the risk limit. If not, the trade SL will be applied according to the risk
   * limit
   * @property {Boolean} [reverse] flag indicating that the strategy should be copied in a reverse direction
   * @property {String} [reduceCorrelations] optional setting indicating whether to enable automatic trade correlation
   * reduction. Possible settings are not specified (disable correlation risk restrictions), by-strategy (limit
   * correlations for the strategy) or by-account (limit correlations for the account)
   * @property {CopyFactoryStrategyStopOut} [stopOutRisk] optional stop out setting. All trading will be terminated and
   * positions closed once equity drawdown reaches this value
   * @property {CopyFactoryStrategySymbolFilter} [symbolFilter] symbol filters which can be used to copy only specific
   * symbols or exclude some symbols from copying
   * @property {CopyFactoryStrategyNewsFilter} [newsFilter] news risk filter configuration
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] optional strategy risk limits. You can configure
   * trading to be stopped once total drawdown generated during specific period is exceeded. Can be specified either for
   * balance or equity drawdown
   * @property {CopyFactoryStrategyMaxStopLoss} [maxStopLoss] optional stop loss value restriction
   * @property {Number} [maxLeverage] optional max leverage risk restriction. All trades resulting in a leverage value
   * higher than specified will be skipped
   * @property {Array<CopyFactoryStrategySymbolMapping>} [symbolMapping] defines how symbol name should be changed when
   * trading (e.g. when broker uses symbol names with unusual suffixes). By default this setting is disabled and the
   * trades are copied using signal source symbol name
   * @property {CopyFactoryStrategyTradeSizeAcaling} [tradeSizeScaling] Trade size scaling settings. By default the
   * trade size on strategy subscriber side will be scaled according to balance to preserve risk.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   */

  /**
   * Portfolio strategy update
   * @typedef {Object} CopyFactoryPortfolioStrategyUpdate
   * @property {String} name strategy human-readable name
   * @property {String} description longer strategy human-readable description
   * @property {Array<CopyFactoryPortfolioMember>} members array of portfolio memebers
   * @property {CopyFactoryStrategyCommissionScheme} [commissionScheme] commission scheme allowed by this strategy. By
   * default monthly billing period with no commission is being used
   * @property {Boolean} [skipPendingOrders] optional flag indicating that pending orders should not be copied.
   * Default is to copy pending orders
   * @property {Number} [maxTradeRisk] optional max risk per trade, expressed as a fraction of 1. If trade has a SL, the
   * trade size will be adjusted to match the risk limit. If not, the trade SL will be applied according to the risk
   * limit
   * @property {Boolean} [reverse] flag indicating that the strategy should be copied in a reverse direction
   * @property {String} [reduceCorrelations] optional setting indicating whether to enable automatic trade correlation
   * reduction. Possible settings are not specified (disable correlation risk restrictions), by-strategy (limit
   * correlations for the strategy) or by-account (limit correlations for the account)
   * @property {CopyFactoryStrategyStopOut} [stopOutRisk] optional stop out setting. All trading will be terminated and
   * positions closed once equity drawdown reaches this value
   * @property {CopyFactoryStrategySymbolFilter} [symbolFilter] symbol filters which can be used to copy only specific
   * symbols or exclude some symbols from copying
   * @property {CopyFactoryStrategyNewsFilter} [newsFilter] news risk filter configuration
   * @property {Array<CopyFactoryStrategyRiskLimit>} [riskLimits] optional strategy risk limits. You can configure
   * trading to be stopped once total drawdown generated during specific period is exceeded. Can be specified either for
   * balance or equity drawdown
   * @property {CopyFactoryStrategyMaxStopLoss} [maxStopLoss] optional stop loss value restriction
   * @property {Number} [maxLeverage] optional max leverage risk restriction. All trades resulting in a leverage value
   * higher than specified will be skipped
   * @property {Array<CopyFactoryStrategySymbolMapping>} [symbolMapping] defines how symbol name should be changed when
   * trading (e.g. when broker uses symbol names with unusual suffixes). By default this setting is disabled and the
   * trades are copied using signal source symbol name
   * @property {CopyFactoryStrategyTradeSizeAcaling} [tradeSizeScaling] Trade size scaling settings. By default the
   * trade size on strategy subscriber side will be scaled according to balance to preserve risk.
   * @property {boolean} [copyStopLoss] flag indicating whether stop loss should be copied. Default is to copy stop
   * loss.
   * @property {boolean} [copyTakeProfit] flag indicating whether take profit should be copied. Default is to copy take
   * profit.
   * @property {number} [minTradeVolume] Minimum trade volume to copy. Trade signals with a smaller volume will not be
   * copied
   * @property {number} [maxTradeVolume] Maximum trade volume to copy. Trade signals with a larger volume will be copied
   * with maximum volume instead
   */

  /**
   * Portfolio strategy, i.e. the strategy which includes a set of other strategies
   * @typedef {CopyFactoryPortfolioStrategyUpdate} CopyFactoryPortfolioStrategy
   * @property {String} _id unique strategy id
   * @property {Number} platformCommissionRate commission rate the platform charges for strategy copying, applied to
   * commissions charged by provider. This commission applies only to accounts not managed directly by provider. Should
   * be fraction of 1
   */

  /**
   * Retrieves CopyFactory copy portfolio strategies. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getPortfolioStrategies/
   * @return {Promise<Array<CopyFactoryPortfolioStrategy>>} promise resolving with CopyFactory portfolio strategies
   * found
   */
  getPortfolioStrategies() {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getPortfolioStrategies');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/portfolio-strategies`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Retrieves CopyFactory copy portfolio strategy by id. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getPortfolioStrategy/
   * @param {string} portfolioId portfolio strategy id
   * @return {Promise<CopyFactoryPortfolioStrategy>} promise resolving with CopyFactory portfolio strategy found
   */
  getPortfolioStrategy(portfolioId) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getPortfolioStrategy');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/portfolio-strategies/${portfolioId}`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Updates a CopyFactory portfolio strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/updatePortfolioStrategy/
   * @param {String} id copy trading portfolio strategy id
   * @param {CopyFactoryPortfolioStrategyUpdate} strategy portfolio strategy update
   * @return {Promise} promise resolving when portfolio strategy is updated
   */
  updatePortfolioStrategy(id, strategy) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('updatePortfolioStrategy');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/portfolio-strategies/${id}`,
      method: 'PUT',
      headers: {
        'auth-token': this._token
      },
      body: strategy,
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Deletes a CopyFactory portfolio strategy. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/removePortfolioStrategy/
   * @param {String} id portfolio strategy id
   * @return {Promise} promise resolving when portfolio strategy is removed
   */
  removePortfolioStrategy(id) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('removePortfolioStrategy');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/portfolio-strategies/${id}`,
      method: 'DELETE',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    return this._httpClient.request(opts);
  }

  /**
   * Resynchronization task
   * @typedef {Object} ResynchronizationTask
   * @property {String} _id task unique id
   * @property {String} type task type. One of CREATE_ACCOUNT, CREATE_STRATEGY, UPDATE_STRATEGY, REMOVE_STRATEGY
   * @property {Date} createdAt the time task was created at
   * @property {String} status task status. One of PLANNED, EXECUTING, SYNCHRONIZING
   */

  /**
   * Returns list of active resynchronization tasks for a specified connection. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/configuration/getActiveResynchronizationTasks/
   * @param {String} connectionId MetaApi account id to return tasks for
   * @return {Promise<Array<ResynchronizationTask>>} promise resolving with list of active resynchronization tasks
   */
  async getActiveResynchronizationTasks(connectionId) {
    if (this._isNotJwtToken()) {
      return this._handleNoAccessError('getActiveResynchronizationTasks');
    }
    const opts = {
      url: `${this._host}/users/current/configuration/connections/${connectionId}/active-resynchronization-tasks`,
      method: 'GET',
      headers: {
        'auth-token': this._token
      },
      json: true
    };
    let tasks = await this._httpClient.request(opts);
    tasks.forEach(t => t.createdAt = new Date(t.createdAt));
    return tasks;
  }

  /**
   * Waits until active resynchronization tasks are completed
   * @param {String} connectionId MetaApi account id to wait tasks completed for
   * @param {Number} timeoutInSeconds wait timeout in seconds, default is 5m
   * @param {Number} intervalInMilliseconds interval between tasks reload while waiting for a change, default is 1s
   * @return {Promise} promise which resolves when tasks are completed
   * @throws {TimeoutError} if tasks have not completed withing timeout allowed
   */
  async waitResynchronizationTasksCompleted(connectionId, timeoutInSeconds = 300, intervalInMilliseconds = 1000) {
    let startTime = Date.now();
    let tasks = await this.getActiveResynchronizationTasks(connectionId);
    while (tasks.length !== 0 && startTime + timeoutInSeconds * 1000 > Date.now()) {
      await new _promise2.default(res => setTimeout(res, intervalInMilliseconds));
      tasks = await this.getActiveResynchronizationTasks(connectionId);
    }
    if (tasks.length !== 0) {
      throw new _timeoutError2.default('Timed out waiting for resynchronization tasks for account ' + connectionId + ' to be completed');
    }
  }
}
exports.default = ConfigurationClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL2NvcHlGYWN0b3J5L2NvbmZpZ3VyYXRpb24uY2xpZW50LmVzNiJdLCJuYW1lcyI6WyJDb25maWd1cmF0aW9uQ2xpZW50IiwiTWV0YUFwaUNsaWVudCIsImNvbnN0cnVjdG9yIiwiaHR0cENsaWVudCIsInRva2VuIiwiZG9tYWluIiwiX2hvc3QiLCJnZW5lcmF0ZVN0cmF0ZWd5SWQiLCJfaXNOb3RKd3RUb2tlbiIsIl9oYW5kbGVOb0FjY2Vzc0Vycm9yIiwib3B0cyIsInVybCIsIm1ldGhvZCIsImhlYWRlcnMiLCJfdG9rZW4iLCJqc29uIiwiX2h0dHBDbGllbnQiLCJyZXF1ZXN0IiwiZ2VuZXJhdGVBY2NvdW50SWQiLCJyYW5kb21zdHJpbmciLCJnZW5lcmF0ZSIsImdldEFjY291bnRzIiwiZ2V0QWNjb3VudCIsImFjY291bnRJZCIsInVwZGF0ZUFjY291bnQiLCJpZCIsImFjY291bnQiLCJib2R5IiwicmVtb3ZlQWNjb3VudCIsImdldFN0cmF0ZWdpZXMiLCJnZXRTdHJhdGVneSIsInN0cmF0ZWd5SWQiLCJ1cGRhdGVTdHJhdGVneSIsInN0cmF0ZWd5IiwicmVtb3ZlU3RyYXRlZ3kiLCJnZXRQb3J0Zm9saW9TdHJhdGVnaWVzIiwiZ2V0UG9ydGZvbGlvU3RyYXRlZ3kiLCJwb3J0Zm9saW9JZCIsInVwZGF0ZVBvcnRmb2xpb1N0cmF0ZWd5IiwicmVtb3ZlUG9ydGZvbGlvU3RyYXRlZ3kiLCJnZXRBY3RpdmVSZXN5bmNocm9uaXphdGlvblRhc2tzIiwiY29ubmVjdGlvbklkIiwidGFza3MiLCJmb3JFYWNoIiwidCIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ3YWl0UmVzeW5jaHJvbml6YXRpb25UYXNrc0NvbXBsZXRlZCIsInRpbWVvdXRJblNlY29uZHMiLCJpbnRlcnZhbEluTWlsbGlzZWNvbmRzIiwic3RhcnRUaW1lIiwibm93IiwibGVuZ3RoIiwicmVzIiwic2V0VGltZW91dCIsIlRpbWVvdXRFcnJvciJdLCJtYXBwaW5n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QU0sS0FBS0YsK0JBQUwsQ0FBcUNDLFlBQXJDLENBQWxCO0FBQ0EsV0FBT0MsTUFBTVUsTUFBTixLQUFpQixDQUFqQixJQUF1QkYsWUFBWUYsbUJBQW1CLElBQWhDLEdBQXdDRixLQUFLSyxHQUFMLEVBQXJFLEVBQWlGO0FBQy9FLFlBQU0sc0JBQVlFLE9BQU9DLFdBQVdELEdBQVgsRUFBZ0JKLHNCQUFoQixDQUFuQixDQUFOO0FBQ0FQLGNBQVEsTUFBTSxLQUFLRiwrQkFBTCxDQUFxQ0MsWUFBckMsQ0FBZDtBQUNEO0FBQ0QsUUFBSUMsTUFBTVUsTUFBTixLQUFpQixDQUFyQixFQUF3QjtBQUN0QixZQUFNLElBQUlHLHNCQUFKLENBQWlCLCtEQUNuQmQsWUFEbUIsR0FDSixrQkFEYixDQUFOO0FBRUQ7QUFDRjtBQXB0QjREO2tCQUExQ3pDLG1CIiwiZmlsZSI6ImNvbmZpZ3VyYXRpb24uY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgTWV0YUFwaUNsaWVudCBmcm9tICcuLi9tZXRhQXBpLmNsaWVudCc7XG5pbXBvcnQgVGltZW91dEVycm9yIGZyb20gJy4uL3RpbWVvdXRFcnJvcic7XG5pbXBvcnQgcmFuZG9tc3RyaW5nIGZyb20gJ3JhbmRvbXN0cmluZyc7XG5cbi8qKlxuICogbWV0YWFwaS5jbG91ZCBDb3B5RmFjdG9yeSBjb25maWd1cmF0aW9uIEFQSSAodHJhZGUgY29weWluZyBjb25maWd1cmF0aW9uIEFQSSkgY2xpZW50IChzZWVcbiAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5LylcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uZmlndXJhdGlvbkNsaWVudCBleHRlbmRzIE1ldGFBcGlDbGllbnQge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIENvcHlGYWN0b3J5IGNvbmZpZ3VyYXRpb24gQVBJIGNsaWVudCBpbnN0YW5jZVxuICAgKiBAcGFyYW0ge0h0dHBDbGllbnR9IGh0dHBDbGllbnQgSFRUUCBjbGllbnRcbiAgICogQHBhcmFtIHtTdHJpbmd9IHRva2VuIGF1dGhvcml6YXRpb24gdG9rZW5cbiAgICogQHBhcmFtIHtTdHJpbmd9IGRvbWFpbiBkb21haW4gdG8gY29ubmVjdCB0bywgZGVmYXVsdCBpcyBhZ2lsaXVtdHJhZGUuYWdpbGl1bXRyYWRlLmFpXG4gICAqL1xuICBjb25zdHJ1Y3RvcihodHRwQ2xpZW50LCB0b2tlbiwgZG9tYWluID0gJ2FnaWxpdW10cmFkZS5hZ2lsaXVtdHJhZGUuYWknKSB7XG4gICAgc3VwZXIoaHR0cENsaWVudCwgdG9rZW4sIGRvbWFpbik7XG4gICAgdGhpcy5faG9zdCA9IGBodHRwczovL3RyYWRpbmctYXBpLXYxLiR7ZG9tYWlufWA7XG4gIH1cblxuICAvKipcbiAgICogU3RyYXRlZ3kgaWRcbiAgICogQHR5cGVkZWYge09iamVjdH0gU3RyYXRlZ3lJZFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gaWQgc3RyYXRlZ3kgaWRcbiAgICovXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBuZXcgdW51c2VkIHN0cmF0ZWd5IGlkLiBNZXRob2QgaXMgYWNjZXNzaWJsZSBvbmx5IHdpdGggQVBJIGFjY2VzcyB0b2tlbi4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vZ2VuZXJhdGVTdHJhdGVneUlkL1xuICAgKiBAcmV0dXJuIHtQcm9taXNlPFN0cmF0ZWd5SWQ+fSBwcm9taXNlIHJlc29sdmluZyB3aXRoIHN0cmF0ZWd5IGlkIGdlbmVyYXRlZFxuICAgKi9cbiAgZ2VuZXJhdGVTdHJhdGVneUlkKCkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdnZW5lcmF0ZVN0cmF0ZWd5SWQnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3VudXNlZC1zdHJhdGVneS1pZGAsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZXMgcmFuZG9tIGFjY291bnQgaWRcbiAgICogQHJldHVybiB7U3RyaW5nfSBhY2NvdW50IGlkXG4gICAqL1xuICBnZW5lcmF0ZUFjY291bnRJZCgpIHtcbiAgICByZXR1cm4gcmFuZG9tc3RyaW5nLmdlbmVyYXRlKDY0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBhY2NvdW50IG1vZGVsXG4gICAqIEB0eXBlZGVmIHtDb3B5RmFjdG9yeUFjY291bnRVcGRhdGV9IENvcHlGYWN0b3J5QWNjb3VudFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gX2lkIGFjY291bnQgdW5pcXVlIGlkZW50aWZpZXJcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IHN1YnNjcmlwdGlvbnNcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVN1YnNjcmlwdGlvblxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gc3RyYXRlZ3lJZCBpZCBvZiB0aGUgc3RyYXRlZ3kgdG8gc3Vic2NyaWJlIHRvXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbXVsdGlwbGllcl0gb3B0aW9uYWwgc3Vic2NyaXB0aW9uIG11bHRpcGxpZXIsIGRlZmF1bHQgaXMgMXhcbiAgICogQHByb3BlcnR5IHtCb29sZWFufSBbc2tpcFBlbmRpbmdPcmRlcnNdIG9wdGlvbmFsIGZsYWcgaW5kaWNhdGluZyB0aGF0IHBlbmRpbmcgb3JkZXJzIHNob3VsZCBub3QgYmUgY29waWVkLiBEZWZhdWx0XG4gICAqIGlzIHRvIGNvcHkgcGVuZGluZyBvcmRlcnNcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFtjbG9zZU9ubHldIG9wdGlvbmFsIHNldHRpbmcgd2ljaCBpbnN0cnVjdHMgdGhlIGFwcGxpY2F0aW9uIG5vdCB0byBvcGVuIG5ldyBwb3NpdGlvbnMuIGJ5LXN5bWJvbFxuICAgKiBtZWFucyB0aGF0IGl0IGlzIHN0aWxsIGFsbG93ZWQgdG8gb3BlbiBuZXcgcG9zaXRpb25zIHdpdGggYSBzeW1ib2wgZXF1YWwgdG8gdGhlIHN5bWJvbCBvZiBhbiBleGlzdGluZyBzdHJhdGVneVxuICAgKiBwb3NpdGlvbiAoY2FuIGJlIHVzZWQgdG8gZ3JhY2VmdWx5IGV4aXQgc3RyYXRlZ2llcyB0cmFkaW5nIGluIG5ldHRpbmcgbW9kZSBvciBwbGFjaW5nIGEgc2VyaWVzIG9mIHJlbGF0ZWQgdHJhZGVzXG4gICAqIHBlciBzeW1ib2wpLiBPbmUgb2YgYnktcG9zaXRpb24sIGJ5LXN5bWJvbCBvciBsZWF2ZSBlbXB0eSB0byBkaXNhYmxlIHRoaXMgc2V0dGluZy5cbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFttYXhUcmFkZVJpc2tdIG9wdGlvbmFsIG1heCByaXNrIHBlciB0cmFkZSwgZXhwcmVzc2VkIGFzIGEgZnJhY3Rpb24gb2YgMS4gSWYgdHJhZGUgaGFzIGEgU0wsIHRoZVxuICAgKiB0cmFkZSBzaXplIHdpbGwgYmUgYWRqdXN0ZWQgdG8gbWF0Y2ggdGhlIHJpc2sgbGltaXQuIElmIG5vdCwgdGhlIHRyYWRlIFNMIHdpbGwgYmUgYXBwbGllZCBhY2NvcmRpbmcgdG8gdGhlIHJpc2tcbiAgICogbGltaXRcbiAgICogQHByb3BlcnR5IHtCb29sZWFufSBbcmV2ZXJzZV0gZmxhZyBpbmRpY2F0aW5nIHRoYXQgdGhlIHN0cmF0ZWd5IHNob3VsZCBiZSBjb3BpZWQgaW4gYSByZXZlcnNlIGRpcmVjdGlvblxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gW3JlZHVjZUNvcnJlbGF0aW9uc10gb3B0aW9uYWwgc2V0dGluZyBpbmRpY2F0aW5nIHdoZXRoZXIgdG8gZW5hYmxlIGF1dG9tYXRpYyB0cmFkZSBjb3JyZWxhdGlvblxuICAgKiByZWR1Y3Rpb24uIFBvc3NpYmxlIHNldHRpbmdzIGFyZSBub3Qgc3BlY2lmaWVkIChkaXNhYmxlIGNvcnJlbGF0aW9uIHJpc2sgcmVzdHJpY3Rpb25zKSwgYnktc3RyYXRlZ3kgKGxpbWl0XG4gICAqIGNvcnJlbGF0aW9ucyBmb3IgdGhlIHN0cmF0ZWd5KSBvciBieS1hY2NvdW50IChsaW1pdCBjb3JyZWxhdGlvbnMgZm9yIHRoZSBhY2NvdW50KVxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lTdG9wT3V0fSBbc3RvcE91dFJpc2tdIG9wdGlvbmFsIHN0b3Agb3V0IHNldHRpbmcuIEFsbCB0cmFkaW5nIHdpbGwgYmUgdGVybWluYXRlZCBhbmQgcG9zaXRpb25zIGNsb3NlZFxuICAgKiBvbmNlIGVxdWl0eSBkcmF3ZG93biByZWFjaGVzIHRoaXMgdmFsdWVcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5U3ltYm9sRmlsdGVyfSBbc3ltYm9sRmlsdGVyXSBvcHRpb25hbCBzeW1ib2wgZmlsdGVyIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGNvcHkgb25seSBzcGVjaWZpY1xuICAgKiBzeW1ib2xzIG9yIGV4Y2x1ZGUgc29tZSBzeW1ib2xzIGZyb20gY29weWluZ1xuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lOZXdzRmlsdGVyfSBbbmV3c0ZpbHRlcl0gb3B0aW9uYWwgbmV3cyByaXNrIGZpbHRlciBjb25maWd1cmF0aW9uXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8Q29weUZhY3RvcnlTdHJhdGVneVJpc2tMaW1pdD59IFtyaXNrTGltaXRzXSBvcHRpb25hbCBzdHJhdGVneSByaXNrIGxpbWl0cy4gWW91IGNhbiBjb25maWd1cmUgdHJhZGluZyB0byBiZVxuICAgKiBzdG9wcGVkIG9uY2UgdG90YWwgZHJhd2Rvd24gZ2VuZXJhdGVkIGR1cmluZyBzcGVjaWZpYyBwZXJpb2QgaXMgZXhjZWVkZWQuIENhbiBiZSBzcGVjaWZpZWQgZWl0aGVyIGZvciBiYWxhbmNlIG9yXG4gICAqIGVxdWl0eSBkcmF3ZG93blxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lNYXhTdG9wTG9zc30gW21heFN0b3BMb3NzXSBvcHRpb25hbCBzdG9wIGxvc3MgdmFsdWUgcmVzdHJpY3Rpb25cbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFttYXhMZXZlcmFnZV0gb3B0aW9uYWwgc2V0dGluZyBpbmRpY2F0aW5nIG1heGltdW0gbGV2ZXJhZ2UgYWxsb3dlZCB3aGVuIG9wZW5pbmcgYSBuZXcgcG9zaXRpb25zLlxuICAgKiBBbnkgdHJhZGUgd2hpY2ggcmVzdWx0cyBpbiBhIGhpZ2hlciBsZXZlcmFnZSB3aWxsIGJlIGRpc2NhcmRlZFxuICAgKiBAcHJvcGVydHkge0FycmF5PENvcHlGYWN0b3J5U3RyYXRlZ3lTeW1ib2xNYXBwaW5nPn0gW3N5bWJvbE1hcHBpbmddIGRlZmluZXMgaG93IHN5bWJvbCBuYW1lIHNob3VsZCBiZSBjaGFuZ2VkIHdoZW5cbiAgICogdHJhZGluZyAoZS5nLiB3aGVuIGJyb2tlciB1c2VzIHN5bWJvbCBuYW1lcyB3aXRoIHVudXN1YWwgc3VmZml4ZXMpLiBCeSBkZWZhdWx0IHRoaXMgc2V0dGluZyBpcyBkaXNhYmxlZCBhbmQgdGhlXG4gICAqIHRyYWRlcyBhcmUgY29waWVkIHVzaW5nIHNpZ25hbCBzb3VyY2Ugc3ltYm9sIG5hbWVcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5VHJhZGVTaXplQWNhbGluZ30gW3RyYWRlU2l6ZVNjYWxpbmddIFRyYWRlIHNpemUgc2NhbGluZyBzZXR0aW5ncy4gQnkgZGVmYXVsdCB0aGVcbiAgICogdHJhZGUgc2l6ZSBvbiBzdHJhdGVneSBzdWJzY3JpYmVyIHNpZGUgd2lsbCBiZSBzY2FsZWQgYWNjb3JkaW5nIHRvIGJhbGFuY2UgdG8gcHJlc2VydmUgcmlzay5cbiAgICogQHByb3BlcnR5IHtib29sZWFufSBbY29weVN0b3BMb3NzXSBmbGFnIGluZGljYXRpbmcgd2hldGhlciBzdG9wIGxvc3Mgc2hvdWxkIGJlIGNvcGllZC4gRGVmYXVsdCBpcyB0byBjb3B5IHN0b3BcbiAgICogbG9zcy5cbiAgICogQHByb3BlcnR5IHtib29sZWFufSBbY29weVRha2VQcm9maXRdIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHRha2UgcHJvZml0IHNob3VsZCBiZSBjb3BpZWQuIERlZmF1bHQgaXMgdG8gY29weSB0YWtlXG4gICAqIHByb2ZpdC5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFttaW5UcmFkZVZvbHVtZV0gTWluaW11bSB0cmFkZSB2b2x1bWUgdG8gY29weS4gVHJhZGUgc2lnbmFscyB3aXRoIGEgc21hbGxlciB2b2x1bWUgd2lsbCBub3QgYmVcbiAgICogY29waWVkXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWF4VHJhZGVWb2x1bWVdIE1heGltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIGxhcmdlciB2b2x1bWUgd2lsbCBiZSBjb3BpZWRcbiAgICogd2l0aCBtYXhpbXVtIHZvbHVtZSBpbnN0ZWFkXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSB0cmFkZSBzaXplIHNjYWxpbmcgc2V0dGluZ3NcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVRyYWRlU2l6ZVNjYWxpbmdcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IG1vZGUgSWYgc2V0IHRvIGJhbGFuY2UsIHRoZSB0cmFkZSBzaXplIG9uIHN0cmF0ZWd5IHN1YnNjcmliZXIgd2lsbCBiZSBzY2FsZWQgYWNjb3JkaW5nIHRvXG4gICAqIGJhbGFuY2UgdG8gcHJlc2VydmUgcmlzay4gSWYgdmFsdWUgaXMgbm9uZSwgdGhlbiB0cmFkZSBzaXplIHdpbGwgYmUgcHJlc2VydmVkIGlycmVnYXJkbGVzcyBvZiB0aGUgc3Vic2NyaWJlclxuICAgKiBiYWxhbmNlLiBJZiB2YWx1ZSBpcyBjb250cmFjdFNpemUsIHRoZW4gdHJhZGUgc2l6ZSB3aWxsIGJlIHNjYWxlZCBhY2NvcmRpbmcgdG8gY29udHJhY3Qgc2l6ZS4gSWYgZml4ZWRWb2x1bWUgaXNcbiAgICogc2V0LCB0aGVuIHRyYWRlIHdpbGwgYmUgY29waWVkIHdpdGggYSBmaXhlZCB2b2x1bWUgb2YgdHJhY2VWb2x1bWUgc2V0dGluZy4gSWYgZml4ZWRSaXNrIGlzIHNldCwgdGhlbiBlYWNoIHRyYWRlXG4gICAqIHdpbGwgYmUgY29waWVkIHdpdGggYSB0cmFkZSB2b2x1bWUgc2V0IHRvIHJpc2sgc3BlY2lmaWMgZnJhY3Rpb24gb2YgYmFsYW5jZSBhcyBjb25maWd1cmVkIGJ5IHJpc2tGcmFjdGlvbiBzZXR0aW5nLlxuICAgKiBOb3RlLCB0aGF0IGluIGZpeGVkUmlzayBtb2RlIHRyYWRlcyB3aXRob3V0IGEgU0wgYXJlIG5vdCBjb3BpZWQuIERlZmF1bHQgaXMgYmFsYW5jZS4gQWxsb3dlZCB2YWx1ZXM6IG5vbmUsXG4gICAqIGNvbnRyYWN0U2l6ZSwgYmFsYW5jZSwgZml4ZWRWb2x1bWUsIGZpeGVkUmlza1xuICAgKiBAcHJvcGVydHkge251bWJlcn0gW3RyYWRlVm9sdW1lXSBGaXhlZCB0cmFkZSB2b2x1bWUgZm9yIHVzZSB3aXRoIGZpeGVkVm9sdW1lIHRyYWRlIHNpemUgc2NhbGluZyBtb2RlXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbcmlza0ZyYWN0aW9uXSBGaXhlZCByaXNrIGZyYWN0aW9uIGZvciB1c2Ugd2l0aCBmaXhlZFJpc2sgdHJhZGUgc2l6ZSBzY2FsaW5nIG1vZGVcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IHN0b3BvdXQgc2V0dGluZ3NcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVN0b3BPdXRcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IHZhbHVlIHZhbHVlIG9mIHRoZSBzdG9wIG91dCByaXNrLCBleHByZXNzZWQgYXMgYSBmcmFjdGlvbiBvZiAxXG4gICAqIEBwcm9wZXJ0eSB7RGF0ZX0gW3N0YXJ0VGltZV0gdGhlIHRpbWUgdG8gc3RhcnQgcmlzayBjYWxjdWxhdGlvbiBmcm9tLiBBbGwgcHJldmlvdXMgdHJhZGVzIHdpbGwgYmUgaWdub3JlZC4gWW91IGNhblxuICAgKiB1c2UgaXQgdG8gcmVzZXQgdGhlIHJpc2sgY291bnRlciBhZnRlciBhIHN0b3BvdXQgZXZlbnRcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN5bWJvbCBmaWx0ZXJcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVN5bWJvbEZpbHRlclxuICAgKiBAcHJvcGVydHkge0FycmF5PFN0cmluZz59IGluY2x1ZGVkIGxpc3Qgb2Ygc3ltYm9scyBjb3BpZWQuIExlYXZlIHRoZSB2YWx1ZSBlbXB0eSB0byBjb3B5IGFsbCBzeW1ib2xzXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8U3RyaW5nPn0gZXhjbHVkZWQgbGlzdCBvZiBzeW1ib2xzIGV4Y2x1ZGVkIGZyb20gY29weWluZy4gTGVhdmUgdGhlIHZhbHVlIGVtcHR5IHRvIGNvcHkgYWxsIHN5bWJvbHNcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IG5ld3MgcmlzayBmaWx0ZXJcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneU5ld3NGaWx0ZXJcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5QnJlYWtpbmdOZXdzRmlsdGVyfSBbYnJlYWtpbmdOZXdzRmlsdGVyXSBvcHRpb25hbCBicmVha2luZyBuZXdzIGZpbHRlclxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lDYWxlbmRhck5ld3NGaWx0ZXJ9IFtjYWxlbmRhck5ld3NGaWx0ZXJdIG9wdGlvbmFsIGNhbGVuZGFyIG5ld3MgZmlsdGVyXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBicmVha2luZyBuZXdzIHJpc2sgZmlsdGVyXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lCcmVha2luZ05ld3NGaWx0ZXJcbiAgICogQHByb3BlcnR5IHtBcnJheTxTdHJpbmc+fSBwcmlvcml0aWVzIGxpc3Qgb2YgYnJlYWtpbmcgbmV3cyBwcmlvcml0aWVzIHRvIHN0b3AgdHJhZGluZyBvbiwgbGVhdmUgZW1wdHkgdG8gZGlzYWJsZVxuICAgKiBicmVha2luZyBuZXdzIGZpbHRlci4gT25lIG9mIGhpZ2gsIG1lZGl1bSwgbG93LlxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW2Nsb3NlUG9zaXRpb25UaW1lR2FwSW5NaW51dGVzXSBvcHRpb25hbCB0aW1lIGludGVydmFsIHNwZWNpZnlpbmcgd2hlbiB0byBmb3JjZSBjbG9zZSBhbiBhbHJlYWR5XG4gICAqIG9wZW4gcG9zaXRpb24gYWZ0ZXIgYnJlYWtpbmcgbmV3cy4gRGVmYXVsdCB2YWx1ZSBpcyA2MCBtaW51dGVzXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbb3BlblBvc2l0aW9uRm9sbG93aW5nVGltZUdhcEluTWludXRlc10gb3B0aW9uYWwgdGltZSBpbnRlcnZhbCBzcGVjaWZ5aW5nIHdoZW4gaXQgaXMgYWxsb3dlZCB0b1xuICAgKiBvcGVuIHBvc2l0aW9uIGFmdGVyIGNhbGVuZGFyIG5ld3MuIERlZmF1bHQgdmFsdWUgaXMgNjAgbWludXRlc1xuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3RvcnkgY2FsZW5kYXIgbmV3IGZpbHRlclxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN0cmF0ZWd5Q2FsZW5kYXJOZXdzRmlsdGVyXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8U3RyaW5nPn0gcHJpb3JpdGllcyBsaXN0IG9mIGNhbGVuZGFyIG5ld3MgcHJpb3JpdGllcyB0byBzdG9wIHRyYWRpbmcgb24sIGxlYXZlIGVtcHR5IHRvIGRpc2FibGVcbiAgICogY2FsZW5kYXIgbmV3cyBmaWx0ZXIuIE9uZSBvZiBlbGVjdGlvbiwgaGlnaCwgbWVkaXVtLCBsb3cuXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbY2xvc2VQb3NpdGlvblRpbWVHYXBJbk1pbnV0ZXNdIG9wdGlvbmFsIHRpbWUgaW50ZXJ2YWwgc3BlY2lmeWluZyB3aGVuIHRvIGZvcmNlIGNsb3NlIGFuIGFscmVhZHlcbiAgICogb3BlbiBwb3NpdGlvbiBiZWZvcmUgY2FsZW5kYXIgbmV3cy4gRGVmYXVsdCB2YWx1ZSBpcyA2MCBtaW51dGVzXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbb3BlblBvc2l0aW9uUHJlY2VkaW5nVGltZUdhcEluTWludXRlc10gb3B0aW9uYWwgdGltZSBpbnRlcnZhbCBzcGVjaWZ5aW5nIHdoZW4gaXQgaXMgc3RpbGxcbiAgICogYWxsb3dlZCB0byBvcGVuIHBvc2l0aW9uIGJlZm9yZSBjYWxlbmRhciBuZXdzLiBEZWZhdWx0IHZhbHVlIGlzIDEyMCBtaW51dGVzXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbb3BlblBvc2l0aW9uRm9sbG93aW5nVGltZUdhcEluTWludXRlc10gb3B0aW9uYWwgdGltZSBpbnRlcnZhbCBzcGVjaWZ5aW5nIHdoZW4gaXQgaXMgYWxsb3dlZCB0b1xuICAgKiBvcGVuIHBvc2l0aW9uIGFmdGVyIGNhbGVuZGFyIG5ld3MuIERlZmF1bHQgdmFsdWUgaXMgNjAgbWludXRlc1xuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3RvcnkgcmlzayBsaW1pdCBmaWx0ZXJcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVJpc2tMaW1pdFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gdHlwZSByZXN0cmljdGlvbiB0eXBlLiBPbmUgb2YgZGFpbHksIG1vbnRobHksIG9yIHllYXJseVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gYXBwbHlUbyBhY2NvdW50IG1ldHJpYyB0byBhcHBseSBsaW1pdCB0by4gT25lIG9mIGJhbGFuY2UsIGVxdWl0eVxuICAgKiBAcHJvcGVydHkge051bWJlcn0gbWF4UmlzayBtYXggZHJhd2Rvd24gYWxsb3dlZCwgZXhwcmVzc2VkIGFzIGEgZnJhY3Rpb24gb2YgMVxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IGNsb3NlUG9zaXRpb25zIHdoZXRoZXIgdG8gZm9yY2UgY2xvc2UgcG9zaXRpb25zIHdoZW4gdGhlIHJpc2sgaXMgcmVhY2hlZC4gSWYgdmFsdWUgaXMgZmFsc2VcbiAgICogdGhlbiBvbmx5IHRoZSBuZXcgdHJhZGVzIHdpbGwgYmUgaGFsdGVkLCBidXQgZXhpc3Rpbmcgb25lcyB3aWxsIG5vdCBiZSBjbG9zZWRcbiAgICogQHByb3BlcnR5IHtEYXRlfSBbc3RhcnRUaW1lXSBvcHRpb25hbCB0aW1lIHRvIHN0YXJ0IHJpc2sgdHJhY2tpbmcgZnJvbS4gQWxsIHByZXZpb3VzIHRyYWRlcyB3aWxsIGJlIGlnbm9yZWQuIFlvdVxuICAgKiBjYW4gdXNlIHRoaXMgdmFsdWUgdG8gcmVzZXQgdGhlIGZpbHRlciBhZnRlciBzdG9wb3V0IGV2ZW50XG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSBtYXggc3RvcCBsb3NzIHNldHRpbmdzXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lNYXhTdG9wTG9zc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gdmFsdWUgbWF4aW11bSBTTCB2YWx1ZVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gdW5pdHMgU0wgdW5pdHMuIE9ubHkgcGlwcyB2YWx1ZSBpcyBzdXBwb3J0ZWQgYXQgdGhpcyBwb2ludFxuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3Rvcnkgc3RyYXRlZ3kgc3ltYm9sIG1hcHBpbmdcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVN5bWJvbE1hcHBpbmdcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGZyb20gc3ltYm9sIG5hbWUgdG8gY29udmVydCBmcm9tXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSB0byBzeW1ib2wgbmFtZSB0byBjb252ZXJ0IHRvXG4gICAqL1xuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgQ29weUZhY3RvcnkgY29weSB0cmFkaW5nIGFjY291bnRzLiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi9nZXRBY2NvdW50cy9cbiAgICogQHJldHVybiB7UHJvbWlzZTxBcnJheTxDb3B5RmFjdG9yeUFjY291bnQ+Pn0gcHJvbWlzZSByZXNvbHZpbmcgd2l0aCBDb3B5RmFjdG9yeSBhY2NvdW50cyBmb3VuZFxuICAgKi9cbiAgZ2V0QWNjb3VudHMoKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2dldEFjY291bnRzJyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAke3RoaXMuX2hvc3R9L3VzZXJzL2N1cnJlbnQvY29uZmlndXJhdGlvbi9hY2NvdW50c2AsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgQ29weUZhY3RvcnkgY29weSB0cmFkaW5nIGFjY291bnQgYnkgaWQuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL2dldEFjY291bnQvXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhY2NvdW50SWQgQ29weUZhY3RvcnkgYWNjb3VudCBpZFxuICAgKiBAcmV0dXJuIHtQcm9taXNlPENvcHlGYWN0b3J5QWNjb3VudD59IHByb21pc2UgcmVzb2x2aW5nIHdpdGggQ29weUZhY3RvcnkgYWNjb3VudCBmb3VuZFxuICAgKi9cbiAgZ2V0QWNjb3VudChhY2NvdW50SWQpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcignZ2V0QWNjb3VudCcpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgJHt0aGlzLl9ob3N0fS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vYWNjb3VudHMvJHthY2NvdW50SWR9YCxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5faHR0cENsaWVudC5yZXF1ZXN0KG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IGFjY291bnQgdXBkYXRlXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5QWNjb3VudFVwZGF0ZVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gbmFtZSBhY2NvdW50IGh1bWFuLXJlYWRhYmxlIG5hbWVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGNvbm5lY3Rpb25JZCBpZCBvZiB0aGUgTWV0YUFwaSBNZXRhVHJhZGVyIGFjY291bnQgdGhpcyBjb3B5IHRyYWRpbmcgYWNjb3VudCBpcyBjb25uZWN0ZWQgdG9cbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFtyZXNlcnZlZE1hcmdpbkZyYWN0aW9uXSBvcHRpb25hbCBmcmFjdGlvbiBvZiByZXNlcnZlZCBtYXJnaW4gdG8gcmVkdWNlIGEgcmlzayBvZiBtYXJnaW4gY2FsbC5cbiAgICogRGVmYXVsdCBpcyB0byByZXNlcnZlIG5vIG1hcmdpbi4gV2UgcmVjb21tZW5kIHVzaW5nIG1heExldmVyYWdlIHNldHRpbmcgaW5zdGVhZC4gU3BlY2lmaWVkIGFzIGEgZnJhY3Rpb24gb2YgYmFsYW5jZVxuICAgKiB0aHVzIHRoZSB2YWx1ZSBpcyB1c3VhbGx5IGdyZWF0ZXIgdGhhbiAxXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8U3RyaW5nPn0gW3Bob25lTnVtYmVyc10gb3B0aW9uYWwgcGhvbmUgbnVtYmVycyB0byBzZW5kIHNtcyBub3RpZmljYXRpb25zIHRvLiBMZWF2ZSBlbXB0eSB0b1xuICAgKiByZWNlaXZlIG5vIHNtcyBub3RpZmljYXRpb25zXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWluVHJhZGVBbW91bnRdIG9wdGlvbmFsIHZhbHVlIG9mIG1pbmltYWwgdHJhZGUgc2l6ZSBhbGxvd2VkLCBleHByZXNzZWQgaW4gYW1vdW50IG9mIGFjY291bnRcbiAgICogY3VycmVuY3kuIENhbiBiZSB1c2VmdWwgaWYgeW91ciBicm9rZXIgY2hhcmdlcyBhIGZpeGVkIGZlZSBwZXIgdHJhbnNhY3Rpb24gc28gdGhhdCB5b3UgY2FuIHNraXAgc21hbGwgdHJhZGVzIHdpdGhcbiAgICogaGlnaCBicm9rZXIgY29tbWlzc2lvbiByYXRlcy4gRGVmYXVsdCBpcyAxMDBcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFtjbG9zZU9ubHldIG9wdGlvbmFsIHNldHRpbmcgd2ljaCBpbnN0cnVjdHMgdGhlIGFwcGxpY2F0aW9uIG5vdCB0byBvcGVuIG5ldyBwb3NpdGlvbnMuIGJ5LXN5bWJvbFxuICAgKiBtZWFucyB0aGF0IGl0IGlzIHN0aWxsIGFsbG93ZWQgdG8gb3BlbiBuZXcgcG9zaXRpb25zIHdpdGggYSBzeW1ib2wgZXF1YWwgdG8gdGhlIHN5bWJvbCBvZiBhbiBleGlzdGluZyBzdHJhdGVneVxuICAgKiBwb3NpdGlvbiAoY2FuIGJlIHVzZWQgdG8gZ3JhY2VmdWx5IGV4aXQgc3RyYXRlZ2llcyB0cmFkaW5nIGluIG5ldHRpbmcgbW9kZSBvciBwbGFjaW5nIGEgc2VyaWVzIG9mIHJlbGF0ZWQgdHJhZGVzXG4gICAqIHBlciBzeW1ib2wpLiBPbmUgb2YgYnktcG9zaXRpb24sIGJ5LXN5bWJvbCBvciBsZWF2ZSBlbXB0eSB0byBkaXNhYmxlIHRoaXMgc2V0dGluZy5cbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5U3RvcE91dH0gW3N0b3BPdXRSaXNrXSBvcHRpb25hbCBzdG9wIG91dCBzZXR0aW5nLiBBbGwgdHJhZGluZyB3aWxsIGJlIHRlcm1pbmF0ZWQgYW5kIHBvc2l0aW9ucyBjbG9zZWRcbiAgICogb25jZSBlcXVpdHkgZHJhd2Rvd24gcmVhY2hlcyB0aGlzIHZhbHVlXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8Q29weUZhY3RvcnlTdHJhdGVneVJpc2tMaW1pdD59IFtyaXNrTGltaXRzXSBvcHRpb25hbCBhY2NvdW50IHJpc2sgbGltaXRzLiBZb3UgY2FuIGNvbmZpZ3VyZSB0cmFkaW5nIHRvIGJlXG4gICAqIHN0b3BwZWQgb25jZSB0b3RhbCBkcmF3ZG93biBnZW5lcmF0ZWQgZHVyaW5nIHNwZWNpZmljIHBlcmlvZCBpcyBleGNlZWRlZC4gQ2FuIGJlIHNwZWNpZmllZCBlaXRoZXIgZm9yIGJhbGFuY2Ugb3JcbiAgICogZXF1aXR5IGRyYXdkb3duXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWF4TGV2ZXJhZ2VdIG9wdGlvbmFsIHNldHRpbmcgaW5kaWNhdGluZyBtYXh1bXVtIGxldmVyYWdlIGFsbG93ZWQgd2hlbiBvcGVuaW5nIGEgbmV3IHBvc2l0aW9ucy5cbiAgICogQW55IHRyYWRlIHdoaWNoIHJlc3VsdHMgaW4gYSBoaWdoZXIgbGV2ZXJhZ2Ugd2lsbCBiZSBkaXNjYXJkZWQuXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2NvcHlTdG9wTG9zc10gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgc3RvcCBsb3NzIHNob3VsZCBiZSBjb3BpZWQuIERlZmF1bHQgaXMgdG8gY29weSBzdG9wXG4gICAqIGxvc3MuXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2NvcHlUYWtlUHJvZml0XSBmbGFnIGluZGljYXRpbmcgd2hldGhlciB0YWtlIHByb2ZpdCBzaG91bGQgYmUgY29waWVkLiBEZWZhdWx0IGlzIHRvIGNvcHkgdGFrZVxuICAgKiBwcm9maXQuXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWluVHJhZGVWb2x1bWVdIE1pbmltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIHNtYWxsZXIgdm9sdW1lIHdpbGwgbm90IGJlXG4gICAqIGNvcGllZFxuICAgKiBAcHJvcGVydHkge251bWJlcn0gW21heFRyYWRlVm9sdW1lXSBNYXhpbXVtIHRyYWRlIHZvbHVtZSB0byBjb3B5LiBUcmFkZSBzaWduYWxzIHdpdGggYSBsYXJnZXIgdm9sdW1lIHdpbGwgYmUgY29waWVkXG4gICAqIHdpdGggbWF4aW11bSB2b2x1bWUgaW5zdGVhZFxuICAgKiBAcHJvcGVydHkge0FycmF5PENvcHlGYWN0b3J5U3RyYXRlZ3lTdWJzY3JpcHRpb24+fSBzdWJzY3JpcHRpb25zIHN0cmF0ZWd5IHN1YnNjcmlwdGlvbnNcbiAgICovXG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYSBDb3B5RmFjdG9yeSB0cmFkZSBjb3B5aW5nIGFjY291bnQuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL3VwZGF0ZUFjY291bnQvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBpZCBjb3B5IHRyYWRpbmcgYWNjb3VudCBpZFxuICAgKiBAcGFyYW0ge0NvcHlGYWN0b3J5QWNjb3VudFVwZGF0ZX0gYWNjb3VudCB0cmFkaW5nIGFjY291bnQgdXBkYXRlXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UgcmVzb2x2aW5nIHdoZW4gYWNjb3VudCBpcyB1cGRhdGVkXG4gICAqL1xuICB1cGRhdGVBY2NvdW50KGlkLCBhY2NvdW50KSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ3VwZGF0ZUFjY291bnQnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL2FjY291bnRzLyR7aWR9YCxcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBhY2NvdW50LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGEgQ29weUZhY3RvcnkgdHJhZGUgY29weWluZyBhY2NvdW50LiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvY29uZmlndXJhdGlvbi9yZW1vdmVBY2NvdW50L1xuICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgY29weSB0cmFkaW5nIGFjY291bnQgaWRcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBhY2NvdW50IGlzIHJlbW92ZWRcbiAgICovXG4gIHJlbW92ZUFjY291bnQoaWQpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcigncmVtb3ZlQWNjb3VudCcpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgJHt0aGlzLl9ob3N0fS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vYWNjb3VudHMvJHtpZH1gLFxuICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9odHRwQ2xpZW50LnJlcXVlc3Qob3B0cyk7XG4gIH1cblxuICAvKipcbiAgICogQ29weUZhY3RvcnkgcHJvdmlkZXIgc3RyYXRlZ3lcbiAgICogQHR5cGVkZWYge0NvcHlGYWN0b3J5U3RyYXRlZ3lVcGRhdGV9IENvcHlGYWN0b3J5U3RyYXRlZ3lcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IF9pZCB1bmlxdWUgc3RyYXRlZ3kgaWRcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IHBsYXRmb3JtQ29tbWlzc2lvblJhdGUgY29tbWlzc2lvbiByYXRlIHRoZSBwbGF0Zm9ybSBjaGFyZ2VzIGZvciBzdHJhdGVneSBjb3B5aW5nLCBhcHBsaWVkIHRvXG4gICAqIGNvbW1pc3Npb25zIGNoYXJnZWQgYnkgcHJvdmlkZXIuIFRoaXMgY29tbWlzc2lvbiBhcHBsaWVzIG9ubHkgdG8gYWNjb3VudHMgbm90IG1hbmFnZWQgZGlyZWN0bHkgYnkgcHJvdmlkZXIuIFNob3VsZFxuICAgKiBiZSBmcmFjdGlvbiBvZiAxXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSBjb21taXNzaW9uIHNjaGVtZVxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN0cmF0ZWd5Q29tbWlzc2lvblNjaGVtZVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gdHlwZSBjb21taXNzaW9uIHR5cGUuIE9uZSBvZiBmbGF0LWZlZSwgbG90cy10cmFkZWQsIGxvdHMtd29uLCBhbW91bnQtdHJhZGVkLCBhbW91bnQtd29uLFxuICAgKiBoaWdoLXdhdGVyLW1hcmtcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGJpbGxpbmdQZXJpb2QgYmlsbGluZyBwZXJpb2QuIE9uZSBvZiB3ZWVrLCBtb250aCwgcXVhcnRlclxuICAgKiBAcHJvcGVydHkge051bWJlcn0gY29tbWlzc2lvblJhdGUgY29tbWlzc2lvbiByYXRlLiBTaG91bGQgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHplcm8gaWYgY29tbWlzc2lvbiB0eXBlIGlzXG4gICAqIGZsYXQtZmVlLCBsb3RzLXRyYWRlZCBvciBsb3RzLXdvbiwgc2hvdWxkIGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB6ZXJvIGFuZCBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gMSBpZlxuICAgKiBjb21taXNzaW9uIHR5cGUgaXMgYW1vdW50LXRyYWRlZCwgYW1vdW50LXdvbiwgaGlnaC13YXRlci1tYXJrLlxuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3Rvcnkgc3RyYXRlZ3kgbWFnaWMgZmlsdGVyXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lNYWdpY0ZpbHRlclxuICAgKiBAcHJvcGVydHkge0FycmF5PFN0cmluZz59IGluY2x1ZGVkIGxpc3Qgb2YgbWFnaWNzIChleHBlcnQgaWRzKSBvciBtYWdpYyByYW5nZXMgY29waWVkLiBMZWF2ZSB0aGUgdmFsdWUgZW1wdHkgdG9cbiAgICogY29weSBhbGwgbWFnaWNzXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8U3RyaW5nPn0gZXhjbHVkZWQgbGlzdCBvZiBtYWdpY3MgKGV4cGVydCBpZHMpIG9yIG1hZ2ljIHJhbmdlcyBleGNsdWRlZCBmcm9tIGNvcHlpbmcuIExlYXZlIHRoZVxuICAgKiB2YWx1ZSBlbXB0eSB0byBjb3B5IGFsbCBtYWdpY3NcbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IHRpbWUgc2V0dGluZ3NcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVRpbWVTZXR0aW5nc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW2xpZmV0aW1lSW5Ib3Vyc10gb3B0aW9uYWwgcG9zaXRpb24gbGlmZXRpbWUuIERlZmF1bHQgaXMgdG8ga2VlcCBwb3NpdGlvbnMgb3BlbiB1cCB0byA5MCBkYXlzXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbb3BlbmluZ0ludGVydmFsSW5NaW51dGVzXSBvcHRpb25hbCB0aW1lIGludGVydmFsIHRvIGNvcHkgbmV3IHBvc2l0aW9ucy4gRGVmYXVsdCBpcyB0byBsZXQgMVxuICAgKiBtaW51dGUgZm9yIHRoZSBwb3NpdGlvbiB0byBnZXQgY29waWVkLiBJZiBwb3NpdGlvbiB3ZXJlIG5vdCBjb3BpZWQgZHVyaW5nIHRoaXMgdGltZSwgdGhlIGNvcHlpbmcgd2lsbCBub3QgYmVcbiAgICogcmV0cmllZCBhbnltb3JlLlxuICAgKi9cblxuICAvKipcbiAgICogQ29weUZhY3Rvcnkgc3RyYXRlZ3kgZXF1aXR5IGN1cnZlIGZpbHRlclxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN0cmF0ZWd5RXF1aXR5Q3VydmVGaWx0ZXJcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IHBlcmlvZCBtb3ZpbmcgYXZlcmFnZSBwZXJpb2QsIG11c3QgYmUgZ3JlYXRlciBvciBlcXVhbCB0byAxXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBncmFudWxhcml0eSBtb3ZpbmcgYXZlcmFnZSBncmFudWxhcml0eSwgYSBwb3NpdGl2ZSBpbnRlZ2VyIGZvbGxvd2VkIGJ5IHRpbWUgdW5pdCwgZS5nLiAyaC5cbiAgICogQWxsb3dlZCB1bml0cyBhcmUgcywgbSwgaCwgZCBhbmQgdy5cbiAgICovXG5cbiAgLyoqXG4gICAqIENvcHlGYWN0b3J5IHN0cmF0ZWd5IGRyYXdkb3duIGZpbHRlclxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb3B5RmFjdG9yeVN0cmF0ZWd5RHJhd2Rvd25GaWx0ZXJcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IG1heERyYXdkb3duIE1heGltdW0gZHJhd2Rvd24gdmFsdWUgYWZ0ZXIgd2hpY2ggYWN0aW9uIGlzIGV4ZWN1dGVkLiBEcmF3ZG93biBzaG91bGQgYmUgY29uZmlndXJlZFxuICAgKiBhcyBhIGZyYWN0aW9uIG9mIDEsIGkuZS4gMC4xNSBtZWFucyAxNSUgZHJhd2Rvd24gdmFsdWVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGFjdGlvbiBBY3Rpb24gdG8gdGFrZSB3aGVuIGRyYXdkb3duIGV4Y2VlZHMgbWF4RHJhd2Rvd24gdmFsdWUuIGluY2x1ZGUgbWVhbnMgdGhlIHRyYWRpbmcgc2lnbmFsXG4gICAqIHdpbGwgYmUgdHJhbnNtaXR0ZWQgb25seSBpZiBkZCBpcyBncmVhdGVyIHRoYW4gbWF4RHJhd2Rvd24gdmFsdWUuIGV4Y2x1ZGUgbWVhbnMgdGhlIHRyYWRpbmcgc2lnbmFsIHdpbGwgYmVcbiAgICogdHJhbnNtaXR0ZWQgb25seSBpZiBkZCBpcyBsZXNzIHRoYW4gbWF4RHJhd2Rvd24gdmFsdWUuXG4gICAqL1xuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgQ29weUZhY3RvcnkgY29weSB0cmFkaW5nIHN0cmF0ZWdpZXMuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL2dldFN0cmF0ZWdpZXMvXG4gICAqIEByZXR1cm4ge1Byb21pc2U8QXJyYXk8Q29weUZhY3RvcnlTdHJhdGVneT4+fSBwcm9taXNlIHJlc29sdmluZyB3aXRoIENvcHlGYWN0b3J5IHN0cmF0ZWdpZXMgZm91bmRcbiAgICovXG4gIGdldFN0cmF0ZWdpZXMoKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2dldFN0cmF0ZWdpZXMnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3N0cmF0ZWdpZXNgLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9odHRwQ2xpZW50LnJlcXVlc3Qob3B0cyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIENvcHlGYWN0b3J5IGNvcHkgdHJhZGluZyBzdHJhdGVneSBieSBpZC4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vZ2V0U3RyYXRlZ3kvXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJhdGVneSBpZCB0cmFkaW5nIHN0cmF0ZWd5IGlkXG4gICAqIEByZXR1cm4ge1Byb21pc2U8Q29weUZhY3RvcnlTdHJhdGVneT59IHByb21pc2UgcmVzb2x2aW5nIHdpdGggQ29weUZhY3Rvcnkgc3RyYXRlZ3kgZm91bmRcbiAgICovXG4gIGdldFN0cmF0ZWd5KHN0cmF0ZWd5SWQpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcignZ2V0U3RyYXRlZ3knKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3N0cmF0ZWdpZXMvJHtzdHJhdGVneUlkfWAsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSB1cGRhdGVcbiAgICogQHR5cGVkZWYge09iamVjdH0gQ29weUZhY3RvcnlTdHJhdGVneVVwZGF0ZVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gbmFtZSBzdHJhdGVneSBodW1hbi1yZWFkYWJsZSBuYW1lXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBkZXNjcmlwdGlvbiBsb25nZXIgc3RyYXRlZ3kgaHVtYW4tcmVhZGFibGUgZGVzY3JpcHRpb25cbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IHBvc2l0aW9uTGlmZWN5Y2xlIHBvc2l0aW9uIGRldGVjdGlvbiBtb2RlLiBBbGxvd2VkIHZhbHVlcyBhcmUgbmV0dGluZyAoc2luZ2xlIHBvc2l0aW9uIHBlclxuICAgKiBzdHJhdGVneSBwZXIgc3ltYm9sKSwgaGVkZ2luZyAobXVsdGlwbGUgcG9zaXRpb25zIHBlciBzdHJhdGVneSBwZXIgc3ltYm9sKVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gY29ubmVjdGlvbklkIGlkIG9mIHRoZSBNZXRhQXBpIGFjY291bnQgcHJvdmlkaW5nIHRoZSBzdHJhdGVneVxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtza2lwUGVuZGluZ09yZGVyc10gb3B0aW9uYWwgZmxhZyBpbmRpY2F0aW5nIHRoYXQgcGVuZGluZyBvcmRlcnMgc2hvdWxkIG5vdCBiZSBjb3BpZWQuXG4gICAqIERlZmF1bHQgaXMgdG8gY29weSBwZW5kaW5nIG9yZGVyc1xuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lDb21taXNzaW9uU2NoZW1lfSBbY29tbWlzc2lvblNjaGVtZV0gY29tbWlzc2lvbiBzY2hlbWUgYWxsb3dlZCBieSB0aGlzIHN0cmF0ZWd5XG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWF4VHJhZGVSaXNrXSBvcHRpb25hbCBtYXggcmlzayBwZXIgdHJhZGUsIGV4cHJlc3NlZCBhcyBhIGZyYWN0aW9uIG9mIDEuIElmIHRyYWRlIGhhcyBhIFNMLCB0aGVcbiAgICogdHJhZGUgc2l6ZSB3aWxsIGJlIGFkanVzdGVkIHRvIG1hdGNoIHRoZSByaXNrIGxpbWl0LiBJZiBub3QsIHRoZSB0cmFkZSBTTCB3aWxsIGJlIGFwcGxpZWQgYWNjb3JkaW5nIHRvIHRoZSByaXNrXG4gICAqIGxpbWl0XG4gICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gW3JldmVyc2VdIGZsYWcgaW5kaWNhdGluZyB0aGF0IHRoZSBzdHJhdGVneSBzaG91bGQgYmUgY29waWVkIGluIGEgcmV2ZXJzZSBkaXJlY3Rpb25cbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFtyZWR1Y2VDb3JyZWxhdGlvbnNdIG9wdGlvbmFsIHNldHRpbmcgaW5kaWNhdGluZyB3aGV0aGVyIHRvIGVuYWJsZSBhdXRvbWF0aWMgdHJhZGUgY29ycmVsYXRpb25cbiAgICogcmVkdWN0aW9uLiBQb3NzaWJsZSBzZXR0aW5ncyBhcmUgbm90IHNwZWNpZmllZCAoZGlzYWJsZSBjb3JyZWxhdGlvbiByaXNrIHJlc3RyaWN0aW9ucyksIGJ5LXN0cmF0ZWd5IChsaW1pdFxuICAgKiBjb3JyZWxhdGlvbnMgZm9yIHRoZSBzdHJhdGVneSkgb3IgYnktYWNjb3VudCAobGltaXQgY29ycmVsYXRpb25zIGZvciB0aGUgYWNjb3VudClcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5U3RvcE91dH0gW3N0b3BPdXRSaXNrXSBvcHRpb25hbCBzdG9wIG91dCBzZXR0aW5nLiBBbGwgdHJhZGluZyB3aWxsIGJlIHRlcm1pbmF0ZWQgYW5kXG4gICAqIHBvc2l0aW9ucyBjbG9zZWQgb25jZSBlcXVpdHkgZHJhd2Rvd24gcmVhY2hlcyB0aGlzIHZhbHVlXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVN5bWJvbEZpbHRlcn0gW3N5bWJvbEZpbHRlcl0gc3ltYm9sIGZpbHRlcnMgd2hpY2ggY2FuIGJlIHVzZWQgdG8gY29weSBvbmx5IHNwZWNpZmljXG4gICAqIHN5bWJvbHMgb3IgZXhjbHVkZSBzb21lIHN5bWJvbHMgZnJvbSBjb3B5aW5nXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneU5ld3NGaWx0ZXJ9IFtuZXdzRmlsdGVyXSBuZXdzIHJpc2sgZmlsdGVyIGNvbmZpZ3VyYXRpb25cbiAgICogQHByb3BlcnR5IHtBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5Umlza0xpbWl0Pn0gW3Jpc2tMaW1pdHNdIG9wdGlvbmFsIHN0cmF0ZWd5IHJpc2sgbGltaXRzLiBZb3UgY2FuIGNvbmZpZ3VyZVxuICAgKiB0cmFkaW5nIHRvIGJlIHN0b3BwZWQgb25jZSB0b3RhbCBkcmF3ZG93biBnZW5lcmF0ZWQgZHVyaW5nIHNwZWNpZmljIHBlcmlvZCBpcyBleGNlZWRlZC4gQ2FuIGJlIHNwZWNpZmllZCBlaXRoZXIgZm9yXG4gICAqIGJhbGFuY2Ugb3IgZXF1aXR5IGRyYXdkb3duXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneU1heFN0b3BMb3NzfSBbbWF4U3RvcExvc3NdIG9wdGlvbmFsIHN0b3AgbG9zcyB2YWx1ZSByZXN0cmljdGlvblxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21heExldmVyYWdlXSBvcHRpb25hbCBtYXggbGV2ZXJhZ2UgcmlzayByZXN0cmljdGlvbi4gQWxsIHRyYWRlcyByZXN1bHRpbmcgaW4gYSBsZXZlcmFnZSB2YWx1ZVxuICAgKiBoaWdoZXIgdGhhbiBzcGVjaWZpZWQgd2lsbCBiZSBza2lwcGVkXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneU1hZ2ljRmlsdGVyfSBbbWFnaWNGaWx0ZXJdIG9wdGlvbmFsIG1hZ2ljIChleHBlcnQgaWQpIGZpbHRlclxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lUaW1lU2V0dGluZ3N9IFt0aW1lU2V0dGluZ3NdIHNldHRpbmdzIHRvIG1hbmFnZSBjb3B5aW5nIHRpbWVmcmFtZSBhbmQgcG9zaXRpb25cbiAgICogbGlmZXRpbWUuIERlZmF1bHQgaXMgdG8gY29weSBwb3NpdGlvbiB3aXRoaW4gMSBtaW51dGUgZnJvbSBiZWluZyBvcGVuZWQgYXQgc291cmNlIGFuZCBsZXQgdGhlIHBvc2l0aW9uIHRvIGxpdmUgZm9yXG4gICAqIHVwIHRvIDkwIGRheXNcbiAgICogQHByb3BlcnR5IHtBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5U3ltYm9sTWFwcGluZz59IFtzeW1ib2xNYXBwaW5nXSBkZWZpbmVzIGhvdyBzeW1ib2wgbmFtZSBzaG91bGQgYmUgY2hhbmdlZCB3aGVuXG4gICAqIHRyYWRpbmcgKGUuZy4gd2hlbiBicm9rZXIgdXNlcyBzeW1ib2wgbmFtZXMgd2l0aCB1bnVzdWFsIHN1ZmZpeGVzKS4gQnkgZGVmYXVsdCB0aGlzIHNldHRpbmcgaXMgZGlzYWJsZWQgYW5kIHRoZVxuICAgKiB0cmFkZXMgYXJlIGNvcGllZCB1c2luZyBzaWduYWwgc291cmNlIHN5bWJvbCBuYW1lXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVRyYWRlU2l6ZUFjYWxpbmd9IFt0cmFkZVNpemVTY2FsaW5nXSBUcmFkZSBzaXplIHNjYWxpbmcgc2V0dGluZ3MuIEJ5IGRlZmF1bHQgdGhlXG4gICAqIHRyYWRlIHNpemUgb24gc3RyYXRlZ3kgc3Vic2NyaWJlciBzaWRlIHdpbGwgYmUgc2NhbGVkIGFjY29yZGluZyB0byBiYWxhbmNlIHRvIHByZXNlcnZlIHJpc2suXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneUVxdWl0eUN1cnZlRmlsdGVyfSBbZXF1aXR5Q3VydmVGaWx0ZXJdIGZpbHRlciB3aGljaCBwZXJtaXRzIHRoZSB0cmFkZXMgb25seSBpZiBhY2NvdW50XG4gICAqIGVxdWl0eSBpcyBncmVhdGVyIHRoYW4gYmFsYW5jZSBtb3ZpbmcgYXZlcmFnZVxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjb3B5U3RvcExvc3NdIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHN0b3AgbG9zcyBzaG91bGQgYmUgY29waWVkLiBEZWZhdWx0IGlzIHRvIGNvcHkgc3RvcFxuICAgKiBsb3NzLlxuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtjb3B5VGFrZVByb2ZpdF0gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdGFrZSBwcm9maXQgc2hvdWxkIGJlIGNvcGllZC4gRGVmYXVsdCBpcyB0byBjb3B5IHRha2VcbiAgICogcHJvZml0LlxuICAgKiBAcHJvcGVydHkge251bWJlcn0gW21pblRyYWRlVm9sdW1lXSBNaW5pbXVtIHRyYWRlIHZvbHVtZSB0byBjb3B5LiBUcmFkZSBzaWduYWxzIHdpdGggYSBzbWFsbGVyIHZvbHVtZSB3aWxsIG5vdCBiZVxuICAgKiBjb3BpZWRcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFttYXhUcmFkZVZvbHVtZV0gTWF4aW11bSB0cmFkZSB2b2x1bWUgdG8gY29weS4gVHJhZGUgc2lnbmFscyB3aXRoIGEgbGFyZ2VyIHZvbHVtZSB3aWxsIGJlIGNvcGllZFxuICAgKiB3aXRoIG1heGltdW0gdm9sdW1lIGluc3RlYWRcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5RHJhd2Rvd25GaWx0ZXJ9IFtkcmF3ZG93bkZpbHRlcl0gTWFzdGVyIGFjY291bnQgc3RyYXRlZ3kgZHJhd2Rvd24gZmlsdGVyXG4gICAqL1xuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGEgQ29weUZhY3Rvcnkgc3RyYXRlZ3kuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL3VwZGF0ZVN0cmF0ZWd5L1xuICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgY29weSB0cmFkaW5nIHN0cmF0ZWd5IGlkXG4gICAqIEBwYXJhbSB7Q29weUZhY3RvcnlTdHJhdGVneVVwZGF0ZX0gc3RyYXRlZ3kgdHJhZGluZyBzdHJhdGVneSB1cGRhdGVcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBzdHJhdGVneSBpcyB1cGRhdGVkXG4gICAqL1xuICB1cGRhdGVTdHJhdGVneShpZCwgc3RyYXRlZ3kpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcigndXBkYXRlU3RyYXRlZ3knKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3N0cmF0ZWdpZXMvJHtpZH1gLFxuICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGJvZHk6IHN0cmF0ZWd5LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGEgQ29weUZhY3Rvcnkgc3RyYXRlZ3kuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL3JlbW92ZVN0cmF0ZWd5L1xuICAgKiBAcGFyYW0ge1N0cmluZ30gaWQgc3RyYXRlZ3kgaWRcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBzdHJhdGVneSBpcyByZW1vdmVkXG4gICAqL1xuICByZW1vdmVTdHJhdGVneShpZCkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdyZW1vdmVTdHJhdGVneScpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgJHt0aGlzLl9ob3N0fS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vc3RyYXRlZ2llcy8ke2lkfWAsXG4gICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3J0Zm9saW8gc3RyYXRlZ3kgbWVtYmVyXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5UG9ydGZvbGlvTWVtYmVyXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBzdHJhdGVneUlkIG1lbWJlciBzdHJhdGVneSBpZFxuICAgKiBAcHJvcGVydHkge051bWJlcn0gbXVsdGlwbGllciBjb3B5aW5nIG11bHRpcGxpZXIgKHdlaWdodCBpbiB0aGUgcG9ydGZvbGlvKVxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtza2lwUGVuZGluZ09yZGVyc10gb3B0aW9uYWwgZmxhZyBpbmRpY2F0aW5nIHRoYXQgcGVuZGluZyBvcmRlcnMgc2hvdWxkIG5vdCBiZSBjb3BpZWQuXG4gICAqIERlZmF1bHQgaXMgdG8gY29weSBwZW5kaW5nIG9yZGVyc1xuICAgKiBAcHJvcGVydHkge051bWJlcn0gW21heFRyYWRlUmlza10gb3B0aW9uYWwgbWF4IHJpc2sgcGVyIHRyYWRlLCBleHByZXNzZWQgYXMgYSBmcmFjdGlvbiBvZiAxLiBJZiB0cmFkZSBoYXMgYSBTTCwgdGhlXG4gICAqIHRyYWRlIHNpemUgd2lsbCBiZSBhZGp1c3RlZCB0byBtYXRjaCB0aGUgcmlzayBsaW1pdC4gSWYgbm90LCB0aGUgdHJhZGUgU0wgd2lsbCBiZSBhcHBsaWVkIGFjY29yZGluZyB0byB0aGUgcmlza1xuICAgKiBsaW1pdFxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtyZXZlcnNlXSBmbGFnIGluZGljYXRpbmcgdGhhdCB0aGUgc3RyYXRlZ3kgc2hvdWxkIGJlIGNvcGllZCBpbiBhIHJldmVyc2UgZGlyZWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbcmVkdWNlQ29ycmVsYXRpb25zXSBvcHRpb25hbCBzZXR0aW5nIGluZGljYXRpbmcgd2hldGhlciB0byBlbmFibGUgYXV0b21hdGljIHRyYWRlIGNvcnJlbGF0aW9uXG4gICAqIHJlZHVjdGlvbi4gUG9zc2libGUgc2V0dGluZ3MgYXJlIG5vdCBzcGVjaWZpZWQgKGRpc2FibGUgY29ycmVsYXRpb24gcmlzayByZXN0cmljdGlvbnMpLCBieS1zdHJhdGVneSAobGltaXRcbiAgICogY29ycmVsYXRpb25zIGZvciB0aGUgc3RyYXRlZ3kpIG9yIGJ5LWFjY291bnQgKGxpbWl0IGNvcnJlbGF0aW9ucyBmb3IgdGhlIGFjY291bnQpXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVN0b3BPdXR9IFtzdG9wT3V0Umlza10gb3B0aW9uYWwgc3RvcCBvdXQgc2V0dGluZy4gQWxsIHRyYWRpbmcgd2lsbCBiZSB0ZXJtaW5hdGVkIGFuZFxuICAgKiBwb3NpdGlvbnMgY2xvc2VkIG9uY2UgZXF1aXR5IGRyYXdkb3duIHJlYWNoZXMgdGhpcyB2YWx1ZVxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lTeW1ib2xGaWx0ZXJ9IFtzeW1ib2xGaWx0ZXJdIHN5bWJvbCBmaWx0ZXJzIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGNvcHkgb25seSBzcGVjaWZpY1xuICAgKiBzeW1ib2xzIG9yIGV4Y2x1ZGUgc29tZSBzeW1ib2xzIGZyb20gY29weWluZ1xuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lOZXdzRmlsdGVyfSBbbmV3c0ZpbHRlcl0gbmV3cyByaXNrIGZpbHRlciBjb25maWd1cmF0aW9uXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8Q29weUZhY3RvcnlTdHJhdGVneVJpc2tMaW1pdD59IFtyaXNrTGltaXRzXSBvcHRpb25hbCBzdHJhdGVneSByaXNrIGxpbWl0cy4gWW91IGNhbiBjb25maWd1cmVcbiAgICogdHJhZGluZyB0byBiZSBzdG9wcGVkIG9uY2UgdG90YWwgZHJhd2Rvd24gZ2VuZXJhdGVkIGR1cmluZyBzcGVjaWZpYyBwZXJpb2QgaXMgZXhjZWVkZWQuIENhbiBiZSBzcGVjaWZpZWQgZWl0aGVyIGZvclxuICAgKiBiYWxhbmNlIG9yIGVxdWl0eSBkcmF3ZG93blxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lNYXhTdG9wTG9zc30gW21heFN0b3BMb3NzXSBvcHRpb25hbCBzdG9wIGxvc3MgdmFsdWUgcmVzdHJpY3Rpb25cbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFttYXhMZXZlcmFnZV0gb3B0aW9uYWwgbWF4IGxldmVyYWdlIHJpc2sgcmVzdHJpY3Rpb24uIEFsbCB0cmFkZXMgcmVzdWx0aW5nIGluIGEgbGV2ZXJhZ2UgdmFsdWVcbiAgICogaGlnaGVyIHRoYW4gc3BlY2lmaWVkIHdpbGwgYmUgc2tpcHBlZFxuICAgKiBAcHJvcGVydHkge0FycmF5PENvcHlGYWN0b3J5U3RyYXRlZ3lTeW1ib2xNYXBwaW5nPn0gW3N5bWJvbE1hcHBpbmddIGRlZmluZXMgaG93IHN5bWJvbCBuYW1lIHNob3VsZCBiZSBjaGFuZ2VkIHdoZW5cbiAgICogdHJhZGluZyAoZS5nLiB3aGVuIGJyb2tlciB1c2VzIHN5bWJvbCBuYW1lcyB3aXRoIHVudXN1YWwgc3VmZml4ZXMpLiBCeSBkZWZhdWx0IHRoaXMgc2V0dGluZyBpcyBkaXNhYmxlZCBhbmQgdGhlXG4gICAqIHRyYWRlcyBhcmUgY29waWVkIHVzaW5nIHNpZ25hbCBzb3VyY2Ugc3ltYm9sIG5hbWVcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5VHJhZGVTaXplQWNhbGluZ30gW3RyYWRlU2l6ZVNjYWxpbmddIFRyYWRlIHNpemUgc2NhbGluZyBzZXR0aW5ncy4gQnkgZGVmYXVsdCB0aGVcbiAgICogdHJhZGUgc2l6ZSBvbiBzdHJhdGVneSBzdWJzY3JpYmVyIHNpZGUgd2lsbCBiZSBzY2FsZWQgYWNjb3JkaW5nIHRvIGJhbGFuY2UgdG8gcHJlc2VydmUgcmlzay5cbiAgICogQHByb3BlcnR5IHtib29sZWFufSBbY29weVN0b3BMb3NzXSBmbGFnIGluZGljYXRpbmcgd2hldGhlciBzdG9wIGxvc3Mgc2hvdWxkIGJlIGNvcGllZC4gRGVmYXVsdCBpcyB0byBjb3B5IHN0b3BcbiAgICogbG9zcy5cbiAgICogQHByb3BlcnR5IHtib29sZWFufSBbY29weVRha2VQcm9maXRdIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHRha2UgcHJvZml0IHNob3VsZCBiZSBjb3BpZWQuIERlZmF1bHQgaXMgdG8gY29weSB0YWtlXG4gICAqIHByb2ZpdC5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFttaW5UcmFkZVZvbHVtZV0gTWluaW11bSB0cmFkZSB2b2x1bWUgdG8gY29weS4gVHJhZGUgc2lnbmFscyB3aXRoIGEgc21hbGxlciB2b2x1bWUgd2lsbCBub3QgYmVcbiAgICogY29waWVkXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWF4VHJhZGVWb2x1bWVdIE1heGltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIGxhcmdlciB2b2x1bWUgd2lsbCBiZSBjb3BpZWRcbiAgICogd2l0aCBtYXhpbXVtIHZvbHVtZSBpbnN0ZWFkXG4gICAqL1xuXG4gIC8qKlxuICAgKiBQb3J0Zm9saW8gc3RyYXRlZ3kgdXBkYXRlXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5UG9ydGZvbGlvU3RyYXRlZ3lVcGRhdGVcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IG5hbWUgc3RyYXRlZ3kgaHVtYW4tcmVhZGFibGUgbmFtZVxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gZGVzY3JpcHRpb24gbG9uZ2VyIHN0cmF0ZWd5IGh1bWFuLXJlYWRhYmxlIGRlc2NyaXB0aW9uXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXk8Q29weUZhY3RvcnlQb3J0Zm9saW9NZW1iZXI+fSBtZW1iZXJzIGFycmF5IG9mIHBvcnRmb2xpbyBtZW1lYmVyc1xuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lDb21taXNzaW9uU2NoZW1lfSBbY29tbWlzc2lvblNjaGVtZV0gY29tbWlzc2lvbiBzY2hlbWUgYWxsb3dlZCBieSB0aGlzIHN0cmF0ZWd5LiBCeVxuICAgKiBkZWZhdWx0IG1vbnRobHkgYmlsbGluZyBwZXJpb2Qgd2l0aCBubyBjb21taXNzaW9uIGlzIGJlaW5nIHVzZWRcbiAgICogQHByb3BlcnR5IHtCb29sZWFufSBbc2tpcFBlbmRpbmdPcmRlcnNdIG9wdGlvbmFsIGZsYWcgaW5kaWNhdGluZyB0aGF0IHBlbmRpbmcgb3JkZXJzIHNob3VsZCBub3QgYmUgY29waWVkLlxuICAgKiBEZWZhdWx0IGlzIHRvIGNvcHkgcGVuZGluZyBvcmRlcnNcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFttYXhUcmFkZVJpc2tdIG9wdGlvbmFsIG1heCByaXNrIHBlciB0cmFkZSwgZXhwcmVzc2VkIGFzIGEgZnJhY3Rpb24gb2YgMS4gSWYgdHJhZGUgaGFzIGEgU0wsIHRoZVxuICAgKiB0cmFkZSBzaXplIHdpbGwgYmUgYWRqdXN0ZWQgdG8gbWF0Y2ggdGhlIHJpc2sgbGltaXQuIElmIG5vdCwgdGhlIHRyYWRlIFNMIHdpbGwgYmUgYXBwbGllZCBhY2NvcmRpbmcgdG8gdGhlIHJpc2tcbiAgICogbGltaXRcbiAgICogQHByb3BlcnR5IHtCb29sZWFufSBbcmV2ZXJzZV0gZmxhZyBpbmRpY2F0aW5nIHRoYXQgdGhlIHN0cmF0ZWd5IHNob3VsZCBiZSBjb3BpZWQgaW4gYSByZXZlcnNlIGRpcmVjdGlvblxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gW3JlZHVjZUNvcnJlbGF0aW9uc10gb3B0aW9uYWwgc2V0dGluZyBpbmRpY2F0aW5nIHdoZXRoZXIgdG8gZW5hYmxlIGF1dG9tYXRpYyB0cmFkZSBjb3JyZWxhdGlvblxuICAgKiByZWR1Y3Rpb24uIFBvc3NpYmxlIHNldHRpbmdzIGFyZSBub3Qgc3BlY2lmaWVkIChkaXNhYmxlIGNvcnJlbGF0aW9uIHJpc2sgcmVzdHJpY3Rpb25zKSwgYnktc3RyYXRlZ3kgKGxpbWl0XG4gICAqIGNvcnJlbGF0aW9ucyBmb3IgdGhlIHN0cmF0ZWd5KSBvciBieS1hY2NvdW50IChsaW1pdCBjb3JyZWxhdGlvbnMgZm9yIHRoZSBhY2NvdW50KVxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lTdG9wT3V0fSBbc3RvcE91dFJpc2tdIG9wdGlvbmFsIHN0b3Agb3V0IHNldHRpbmcuIEFsbCB0cmFkaW5nIHdpbGwgYmUgdGVybWluYXRlZCBhbmRcbiAgICogcG9zaXRpb25zIGNsb3NlZCBvbmNlIGVxdWl0eSBkcmF3ZG93biByZWFjaGVzIHRoaXMgdmFsdWVcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5U3ltYm9sRmlsdGVyfSBbc3ltYm9sRmlsdGVyXSBzeW1ib2wgZmlsdGVycyB3aGljaCBjYW4gYmUgdXNlZCB0byBjb3B5IG9ubHkgc3BlY2lmaWNcbiAgICogc3ltYm9scyBvciBleGNsdWRlIHNvbWUgc3ltYm9scyBmcm9tIGNvcHlpbmdcbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5TmV3c0ZpbHRlcn0gW25ld3NGaWx0ZXJdIG5ld3MgcmlzayBmaWx0ZXIgY29uZmlndXJhdGlvblxuICAgKiBAcHJvcGVydHkge0FycmF5PENvcHlGYWN0b3J5U3RyYXRlZ3lSaXNrTGltaXQ+fSBbcmlza0xpbWl0c10gb3B0aW9uYWwgc3RyYXRlZ3kgcmlzayBsaW1pdHMuIFlvdSBjYW4gY29uZmlndXJlXG4gICAqIHRyYWRpbmcgdG8gYmUgc3RvcHBlZCBvbmNlIHRvdGFsIGRyYXdkb3duIGdlbmVyYXRlZCBkdXJpbmcgc3BlY2lmaWMgcGVyaW9kIGlzIGV4Y2VlZGVkLiBDYW4gYmUgc3BlY2lmaWVkIGVpdGhlciBmb3JcbiAgICogYmFsYW5jZSBvciBlcXVpdHkgZHJhd2Rvd25cbiAgICogQHByb3BlcnR5IHtDb3B5RmFjdG9yeVN0cmF0ZWd5TWF4U3RvcExvc3N9IFttYXhTdG9wTG9zc10gb3B0aW9uYWwgc3RvcCBsb3NzIHZhbHVlIHJlc3RyaWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBbbWF4TGV2ZXJhZ2VdIG9wdGlvbmFsIG1heCBsZXZlcmFnZSByaXNrIHJlc3RyaWN0aW9uLiBBbGwgdHJhZGVzIHJlc3VsdGluZyBpbiBhIGxldmVyYWdlIHZhbHVlXG4gICAqIGhpZ2hlciB0aGFuIHNwZWNpZmllZCB3aWxsIGJlIHNraXBwZWRcbiAgICogQHByb3BlcnR5IHtBcnJheTxDb3B5RmFjdG9yeVN0cmF0ZWd5U3ltYm9sTWFwcGluZz59IFtzeW1ib2xNYXBwaW5nXSBkZWZpbmVzIGhvdyBzeW1ib2wgbmFtZSBzaG91bGQgYmUgY2hhbmdlZCB3aGVuXG4gICAqIHRyYWRpbmcgKGUuZy4gd2hlbiBicm9rZXIgdXNlcyBzeW1ib2wgbmFtZXMgd2l0aCB1bnVzdWFsIHN1ZmZpeGVzKS4gQnkgZGVmYXVsdCB0aGlzIHNldHRpbmcgaXMgZGlzYWJsZWQgYW5kIHRoZVxuICAgKiB0cmFkZXMgYXJlIGNvcGllZCB1c2luZyBzaWduYWwgc291cmNlIHN5bWJvbCBuYW1lXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVRyYWRlU2l6ZUFjYWxpbmd9IFt0cmFkZVNpemVTY2FsaW5nXSBUcmFkZSBzaXplIHNjYWxpbmcgc2V0dGluZ3MuIEJ5IGRlZmF1bHQgdGhlXG4gICAqIHRyYWRlIHNpemUgb24gc3RyYXRlZ3kgc3Vic2NyaWJlciBzaWRlIHdpbGwgYmUgc2NhbGVkIGFjY29yZGluZyB0byBiYWxhbmNlIHRvIHByZXNlcnZlIHJpc2suXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2NvcHlTdG9wTG9zc10gZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgc3RvcCBsb3NzIHNob3VsZCBiZSBjb3BpZWQuIERlZmF1bHQgaXMgdG8gY29weSBzdG9wXG4gICAqIGxvc3MuXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2NvcHlUYWtlUHJvZml0XSBmbGFnIGluZGljYXRpbmcgd2hldGhlciB0YWtlIHByb2ZpdCBzaG91bGQgYmUgY29waWVkLiBEZWZhdWx0IGlzIHRvIGNvcHkgdGFrZVxuICAgKiBwcm9maXQuXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWluVHJhZGVWb2x1bWVdIE1pbmltdW0gdHJhZGUgdm9sdW1lIHRvIGNvcHkuIFRyYWRlIHNpZ25hbHMgd2l0aCBhIHNtYWxsZXIgdm9sdW1lIHdpbGwgbm90IGJlXG4gICAqIGNvcGllZFxuICAgKiBAcHJvcGVydHkge251bWJlcn0gW21heFRyYWRlVm9sdW1lXSBNYXhpbXVtIHRyYWRlIHZvbHVtZSB0byBjb3B5LiBUcmFkZSBzaWduYWxzIHdpdGggYSBsYXJnZXIgdm9sdW1lIHdpbGwgYmUgY29waWVkXG4gICAqIHdpdGggbWF4aW11bSB2b2x1bWUgaW5zdGVhZFxuICAgKi9cblxuICAvKipcbiAgICogUG9ydGZvbGlvIHN0cmF0ZWd5LCBpLmUuIHRoZSBzdHJhdGVneSB3aGljaCBpbmNsdWRlcyBhIHNldCBvZiBvdGhlciBzdHJhdGVnaWVzXG4gICAqIEB0eXBlZGVmIHtDb3B5RmFjdG9yeVBvcnRmb2xpb1N0cmF0ZWd5VXBkYXRlfSBDb3B5RmFjdG9yeVBvcnRmb2xpb1N0cmF0ZWd5XG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBfaWQgdW5pcXVlIHN0cmF0ZWd5IGlkXG4gICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBwbGF0Zm9ybUNvbW1pc3Npb25SYXRlIGNvbW1pc3Npb24gcmF0ZSB0aGUgcGxhdGZvcm0gY2hhcmdlcyBmb3Igc3RyYXRlZ3kgY29weWluZywgYXBwbGllZCB0b1xuICAgKiBjb21taXNzaW9ucyBjaGFyZ2VkIGJ5IHByb3ZpZGVyLiBUaGlzIGNvbW1pc3Npb24gYXBwbGllcyBvbmx5IHRvIGFjY291bnRzIG5vdCBtYW5hZ2VkIGRpcmVjdGx5IGJ5IHByb3ZpZGVyLiBTaG91bGRcbiAgICogYmUgZnJhY3Rpb24gb2YgMVxuICAgKi9cblxuICAvKipcbiAgICogUmV0cmlldmVzIENvcHlGYWN0b3J5IGNvcHkgcG9ydGZvbGlvIHN0cmF0ZWdpZXMuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL2dldFBvcnRmb2xpb1N0cmF0ZWdpZXMvXG4gICAqIEByZXR1cm4ge1Byb21pc2U8QXJyYXk8Q29weUZhY3RvcnlQb3J0Zm9saW9TdHJhdGVneT4+fSBwcm9taXNlIHJlc29sdmluZyB3aXRoIENvcHlGYWN0b3J5IHBvcnRmb2xpbyBzdHJhdGVnaWVzXG4gICAqIGZvdW5kXG4gICAqL1xuICBnZXRQb3J0Zm9saW9TdHJhdGVnaWVzKCkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdnZXRQb3J0Zm9saW9TdHJhdGVnaWVzJyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAke3RoaXMuX2hvc3R9L3VzZXJzL2N1cnJlbnQvY29uZmlndXJhdGlvbi9wb3J0Zm9saW8tc3RyYXRlZ2llc2AsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHBDbGllbnQucmVxdWVzdChvcHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgQ29weUZhY3RvcnkgY29weSBwb3J0Zm9saW8gc3RyYXRlZ3kgYnkgaWQuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL2dldFBvcnRmb2xpb1N0cmF0ZWd5L1xuICAgKiBAcGFyYW0ge3N0cmluZ30gcG9ydGZvbGlvSWQgcG9ydGZvbGlvIHN0cmF0ZWd5IGlkXG4gICAqIEByZXR1cm4ge1Byb21pc2U8Q29weUZhY3RvcnlQb3J0Zm9saW9TdHJhdGVneT59IHByb21pc2UgcmVzb2x2aW5nIHdpdGggQ29weUZhY3RvcnkgcG9ydGZvbGlvIHN0cmF0ZWd5IGZvdW5kXG4gICAqL1xuICBnZXRQb3J0Zm9saW9TdHJhdGVneShwb3J0Zm9saW9JZCkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdnZXRQb3J0Zm9saW9TdHJhdGVneScpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgJHt0aGlzLl9ob3N0fS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vcG9ydGZvbGlvLXN0cmF0ZWdpZXMvJHtwb3J0Zm9saW9JZH1gLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9odHRwQ2xpZW50LnJlcXVlc3Qob3B0cyk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBhIENvcHlGYWN0b3J5IHBvcnRmb2xpbyBzdHJhdGVneS4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vdXBkYXRlUG9ydGZvbGlvU3RyYXRlZ3kvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBpZCBjb3B5IHRyYWRpbmcgcG9ydGZvbGlvIHN0cmF0ZWd5IGlkXG4gICAqIEBwYXJhbSB7Q29weUZhY3RvcnlQb3J0Zm9saW9TdHJhdGVneVVwZGF0ZX0gc3RyYXRlZ3kgcG9ydGZvbGlvIHN0cmF0ZWd5IHVwZGF0ZVxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHJlc29sdmluZyB3aGVuIHBvcnRmb2xpbyBzdHJhdGVneSBpcyB1cGRhdGVkXG4gICAqL1xuICB1cGRhdGVQb3J0Zm9saW9TdHJhdGVneShpZCwgc3RyYXRlZ3kpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcigndXBkYXRlUG9ydGZvbGlvU3RyYXRlZ3knKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3BvcnRmb2xpby1zdHJhdGVnaWVzLyR7aWR9YCxcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBib2R5OiBzdHJhdGVneSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9odHRwQ2xpZW50LnJlcXVlc3Qob3B0cyk7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBhIENvcHlGYWN0b3J5IHBvcnRmb2xpbyBzdHJhdGVneS4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL2NvbmZpZ3VyYXRpb24vcmVtb3ZlUG9ydGZvbGlvU3RyYXRlZ3kvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBpZCBwb3J0Zm9saW8gc3RyYXRlZ3kgaWRcbiAgICogQHJldHVybiB7UHJvbWlzZX0gcHJvbWlzZSByZXNvbHZpbmcgd2hlbiBwb3J0Zm9saW8gc3RyYXRlZ3kgaXMgcmVtb3ZlZFxuICAgKi9cbiAgcmVtb3ZlUG9ydGZvbGlvU3RyYXRlZ3koaWQpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcigncmVtb3ZlUG9ydGZvbGlvU3RyYXRlZ3knKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYCR7dGhpcy5faG9zdH0vdXNlcnMvY3VycmVudC9jb25maWd1cmF0aW9uL3BvcnRmb2xpby1zdHJhdGVnaWVzLyR7aWR9YCxcbiAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5faHR0cENsaWVudC5yZXF1ZXN0KG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3luY2hyb25pemF0aW9uIHRhc2tcbiAgICogQHR5cGVkZWYge09iamVjdH0gUmVzeW5jaHJvbml6YXRpb25UYXNrXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBfaWQgdGFzayB1bmlxdWUgaWRcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IHR5cGUgdGFzayB0eXBlLiBPbmUgb2YgQ1JFQVRFX0FDQ09VTlQsIENSRUFURV9TVFJBVEVHWSwgVVBEQVRFX1NUUkFURUdZLCBSRU1PVkVfU1RSQVRFR1lcbiAgICogQHByb3BlcnR5IHtEYXRlfSBjcmVhdGVkQXQgdGhlIHRpbWUgdGFzayB3YXMgY3JlYXRlZCBhdFxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gc3RhdHVzIHRhc2sgc3RhdHVzLiBPbmUgb2YgUExBTk5FRCwgRVhFQ1VUSU5HLCBTWU5DSFJPTklaSU5HXG4gICAqL1xuICBcbiAgLyoqXG4gICAqIFJldHVybnMgbGlzdCBvZiBhY3RpdmUgcmVzeW5jaHJvbml6YXRpb24gdGFza3MgZm9yIGEgc3BlY2lmaWVkIGNvbm5lY3Rpb24uIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS9jb25maWd1cmF0aW9uL2dldEFjdGl2ZVJlc3luY2hyb25pemF0aW9uVGFza3MvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBjb25uZWN0aW9uSWQgTWV0YUFwaSBhY2NvdW50IGlkIHRvIHJldHVybiB0YXNrcyBmb3JcbiAgICogQHJldHVybiB7UHJvbWlzZTxBcnJheTxSZXN5bmNocm9uaXphdGlvblRhc2s+Pn0gcHJvbWlzZSByZXNvbHZpbmcgd2l0aCBsaXN0IG9mIGFjdGl2ZSByZXN5bmNocm9uaXphdGlvbiB0YXNrc1xuICAgKi9cbiAgYXN5bmMgZ2V0QWN0aXZlUmVzeW5jaHJvbml6YXRpb25UYXNrcyhjb25uZWN0aW9uSWQpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcignZ2V0QWN0aXZlUmVzeW5jaHJvbml6YXRpb25UYXNrcycpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgJHt0aGlzLl9ob3N0fS91c2Vycy9jdXJyZW50L2NvbmZpZ3VyYXRpb24vY29ubmVjdGlvbnMvJHtjb25uZWN0aW9uSWR9L2FjdGl2ZS1yZXN5bmNocm9uaXphdGlvbi10YXNrc2AsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRoaXMuX3Rva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgbGV0IHRhc2tzID0gYXdhaXQgdGhpcy5faHR0cENsaWVudC5yZXF1ZXN0KG9wdHMpO1xuICAgIHRhc2tzLmZvckVhY2godCA9PiB0LmNyZWF0ZWRBdCA9IG5ldyBEYXRlKHQuY3JlYXRlZEF0KSk7XG4gICAgcmV0dXJuIHRhc2tzO1xuICB9XG5cbiAgLyoqXG4gICAqIFdhaXRzIHVudGlsIGFjdGl2ZSByZXN5bmNocm9uaXphdGlvbiB0YXNrcyBhcmUgY29tcGxldGVkXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBjb25uZWN0aW9uSWQgTWV0YUFwaSBhY2NvdW50IGlkIHRvIHdhaXQgdGFza3MgY29tcGxldGVkIGZvclxuICAgKiBAcGFyYW0ge051bWJlcn0gdGltZW91dEluU2Vjb25kcyB3YWl0IHRpbWVvdXQgaW4gc2Vjb25kcywgZGVmYXVsdCBpcyA1bVxuICAgKiBAcGFyYW0ge051bWJlcn0gaW50ZXJ2YWxJbk1pbGxpc2Vjb25kcyBpbnRlcnZhbCBiZXR3ZWVuIHRhc2tzIHJlbG9hZCB3aGlsZSB3YWl0aW5nIGZvciBhIGNoYW5nZSwgZGVmYXVsdCBpcyAxc1xuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHdoaWNoIHJlc29sdmVzIHdoZW4gdGFza3MgYXJlIGNvbXBsZXRlZFxuICAgKiBAdGhyb3dzIHtUaW1lb3V0RXJyb3J9IGlmIHRhc2tzIGhhdmUgbm90IGNvbXBsZXRlZCB3aXRoaW5nIHRpbWVvdXQgYWxsb3dlZFxuICAgKi9cbiAgYXN5bmMgd2FpdFJlc3luY2hyb25pemF0aW9uVGFza3NDb21wbGV0ZWQoY29ubmVjdGlvbklkLCB0aW1lb3V0SW5TZWNvbmRzID0gMzAwLCBpbnRlcnZhbEluTWlsbGlzZWNvbmRzID0gMTAwMCkge1xuICAgIGxldCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGxldCB0YXNrcyA9IGF3YWl0IHRoaXMuZ2V0QWN0aXZlUmVzeW5jaHJvbml6YXRpb25UYXNrcyhjb25uZWN0aW9uSWQpO1xuICAgIHdoaWxlICh0YXNrcy5sZW5ndGggIT09IDAgJiYgKHN0YXJ0VGltZSArIHRpbWVvdXRJblNlY29uZHMgKiAxMDAwKSA+IERhdGUubm93KCkpIHtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcyA9PiBzZXRUaW1lb3V0KHJlcywgaW50ZXJ2YWxJbk1pbGxpc2Vjb25kcykpO1xuICAgICAgdGFza3MgPSBhd2FpdCB0aGlzLmdldEFjdGl2ZVJlc3luY2hyb25pemF0aW9uVGFza3MoY29ubmVjdGlvbklkKTtcbiAgICB9XG4gICAgaWYgKHRhc2tzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgdGhyb3cgbmV3IFRpbWVvdXRFcnJvcignVGltZWQgb3V0IHdhaXRpbmcgZm9yIHJlc3luY2hyb25pemF0aW9uIHRhc2tzIGZvciBhY2NvdW50ICdcbiAgICAgICAgKyBjb25uZWN0aW9uSWQgKyAnIHRvIGJlIGNvbXBsZXRlZCcpO1xuICAgIH1cbiAgfVxufVxuIl19