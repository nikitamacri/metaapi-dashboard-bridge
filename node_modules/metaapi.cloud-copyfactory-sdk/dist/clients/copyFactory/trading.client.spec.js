'use strict';

var _httpClient = require('../httpClient');

var _httpClient2 = _interopRequireDefault(_httpClient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _trading = require('./trading.client');

var _trading2 = _interopRequireDefault(_trading);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const copyFactoryApiUrl = 'https://trading-api-v1.agiliumtrade.agiliumtrade.ai';

/**
 * @test {TradingClient}
 */
describe('TradingClient', () => {

  let tradingClient;
  const token = 'header.payload.sign';
  let httpClient = new _httpClient2.default();
  let sandbox;
  let requestStub;

  before(() => {
    sandbox = _sinon2.default.createSandbox();
  });

  beforeEach(() => {
    tradingClient = new _trading2.default(httpClient, token);
    requestStub = sandbox.stub(httpClient, 'request');
  });

  afterEach(() => {
    sandbox.restore();
  });

  /**
   * @test {TradingClient#resynchronize}
   */
  it('should resynchronize CopyFactory account', async () => {
    await tradingClient.resynchronize('0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef', ['ABCD']);
    _sinon2.default.assert.calledOnceWithExactly(httpClient.request, {
      url: `${copyFactoryApiUrl}/users/current/accounts/` + '0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef/resynchronize',
      method: 'POST',
      headers: {
        'auth-token': token
      },
      json: true,
      qs: {
        strategyId: ['ABCD']
      }
    });
  });

  /**
   * @test {TradingClient#resynchronize}
   */
  it('should not resynchronize account with account token', async () => {
    tradingClient = new _trading2.default(httpClient, 'token');
    try {
      await tradingClient.resynchronize('0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef');
    } catch (error) {
      error.message.should.equal('You can not invoke resynchronize method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {TradingClient#getStopouts}
   */
  it('should retrieve stopouts', async () => {
    let expected = [{
      reason: 'max-drawdown',
      stoppedAt: new Date('2020-08-08T07:57:30.328Z'),
      strategy: {
        id: 'ABCD',
        name: 'Strategy'
      },
      reasonDescription: 'total strategy equity drawdown exceeded limit'
    }];
    requestStub.resolves(expected);
    let stopouts = await tradingClient.getStopouts('0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef');
    stopouts.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(httpClient.request, {
      url: `${copyFactoryApiUrl}/users/current/accounts/` + '0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef/stopouts',
      method: 'GET',
      headers: {
        'auth-token': token
      },
      json: true
    });
  });

  /**
   * @test {TradingClient#getStopouts}
   */
  it('should not retrieve stopouts from API with account token', async () => {
    tradingClient = new _trading2.default(httpClient, 'token');
    try {
      await tradingClient.getStopouts('0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef');
    } catch (error) {
      error.message.should.equal('You can not invoke getStopouts method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {TradingClient#resetStopouts}
   */
  it('should reset stopouts', async () => {
    await tradingClient.resetStopouts('0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef', 'ABCD', 'daily-equity');
    _sinon2.default.assert.calledOnceWithExactly(httpClient.request, {
      url: `${copyFactoryApiUrl}/users/current/accounts/` + '0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef/strategies-subscribed/' + 'ABCD/stopouts/daily-equity/reset',
      method: 'POST',
      headers: {
        'auth-token': token
      },
      json: true
    });
  });

  /**
   * @test {TradingClient#resetStopouts}
   */
  it('should not reset stopouts with account token', async () => {
    tradingClient = new _trading2.default(httpClient, 'token');
    try {
      await tradingClient.resetStopouts('0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef', 'ABCD', 'daily-equity');
    } catch (error) {
      error.message.should.equal('You can not invoke resetStopouts method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });

  /**
   * @test {TradingClient#getUserLog}
   */
  it('should retrieve copy trading user log', async () => {
    let expected = [{
      time: new Date('2020-08-08T07:57:30.328Z'),
      level: 'INFO',
      message: 'message'
    }];
    requestStub.resolves(expected);
    let records = await tradingClient.getUserLog('0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef', new Date('2020-08-01T00:00:00.000Z'), new Date('2020-08-10T00:00:00.000Z'), 10, 100);
    records.should.equal(expected);
    _sinon2.default.assert.calledOnceWithExactly(httpClient.request, {
      url: `${copyFactoryApiUrl}/users/current/accounts/` + '0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef/user-log',
      method: 'GET',
      qs: {
        startTime: new Date('2020-08-01T00:00:00.000Z'),
        endTime: new Date('2020-08-10T00:00:00.000Z'),
        offset: 10,
        limit: 100
      },
      headers: {
        'auth-token': token
      },
      json: true
    });
  });

  /**
   * @test {TradingClient#getUserLog}
   */
  it('should not retrieve copy trading user log from API with account token', async () => {
    tradingClient = new _trading2.default(httpClient, 'token');
    try {
      await tradingClient.getUserLog('0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef');
    } catch (error) {
      error.message.should.equal('You can not invoke getUserLog method, because you have connected with account access token. ' + 'Please use API access token from https://app.metaapi.cloud/token page to invoke this method.');
    }
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGllbnRzL2NvcHlGYWN0b3J5L3RyYWRpbmcuY2xpZW50LnNwZWMuZXM2Il0sIm5hbWVzIjpbImNvcHlGYWN0b3J5QXBpVXJsIiwiZGVzY3JpYmUiLCJ0cmFkaW5nQ2xpZW50IiwidG9rZW4iLCJodHRwQ2xpZW50IiwiSHR0cENsaWVudCIsInNhbmRib3giLCJyZXF1ZXN0U3R1YiIsImJlZm9yZSIsInNpbm9uIiwiY3JlYXRlU2FuZGJveCIsImJlZm9yZUVhY2giLCJUcmFkaW5nQ2xpZW50Iiwic3R1YiIsImFmdGVyRWFjaCIsInJlc3RvcmUiLCJpdCIsInJlc3luY2hyb25pemUiLCJhc3NlcnQiLCJjYWxsZWRPbmNlV2l0aEV4YWN0bHkiLCJyZXF1ZXN0IiwidXJsIiwibWV0aG9kIiwiaGVhZGVycyIsImpzb24iLCJxcyIsInN0cmF0ZWd5SWQiLCJlcnJvciIsIm1lc3NhZ2UiLCJzaG91bGQiLCJlcXVhbCIsImV4cGVjdGVkIiwicmVhc29uIiwic3RvcHBlZEF0IiwiRGF0ZSIsInN0cmF0ZWd5IiwiaWQiLCJuYW1lIiwicmVhc29uRGVzY3JpcHRpb24iLCJyZXNvbHZlcyIsInN0b3BvdXRzIiwiZ2V0U3RvcG91dHMiLCJyZXNldFN0b3BvdXRzIiwidGltZSIsImxldmVsIiwicmVjb3JkcyIsImdldFVzZXJMb2ciLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwib2Zmc2V0IiwibGltaXQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O0FBRUEsTUFBTUEsb0JBQW9CLHFEQUExQjs7QUFFQTs7O0FBR0FDLFNBQVMsZUFBVCxFQUEwQixNQUFNOztBQUU5QixNQUFJQyxhQUFKO0FBQ0EsUUFBTUMsUUFBUSxxQkFBZDtBQUNBLE1BQUlDLGFBQWEsSUFBSUMsb0JBQUosRUFBakI7QUFDQSxNQUFJQyxPQUFKO0FBQ0EsTUFBSUMsV0FBSjs7QUFFQUMsU0FBTyxNQUFNO0FBQ1hGLGNBQVVHLGdCQUFNQyxhQUFO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QUlGQyxlQUFPO0FBSkwsT0FKaUQ7QUFVckQzQixlQUFTO0FBQ1Asc0JBQWNwQjtBQURQLE9BVjRDO0FBYXJEcUIsWUFBTTtBQWIrQyxLQUF2RDtBQWVELEdBMUJEOztBQTRCQTs7O0FBR0FSLEtBQUcsdUVBQUgsRUFBNEUsWUFBWTtBQUN0RmQsb0JBQWdCLElBQUlVLGlCQUFKLENBQWtCUixVQUFsQixFQUE4QixPQUE5QixDQUFoQjtBQUNBLFFBQUk7QUFDRixZQUFNRixjQUFjNEMsVUFBZCxDQUF5QixrRUFBekIsQ0FBTjtBQUNELEtBRkQsQ0FFRSxPQUFPbkIsS0FBUCxFQUFjO0FBQ2RBLFlBQU1DLE9BQU4sQ0FBY0MsTUFBZCxDQUFxQkMsS0FBckIsQ0FDRSxpR0FDQSw4RkFGRjtBQUlEO0FBQ0YsR0FWRDtBQVlELENBbkxEIiwiZmlsZSI6InRyYWRpbmcuY2xpZW50LnNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBIdHRwQ2xpZW50IGZyb20gJy4uL2h0dHBDbGllbnQnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCBUcmFkaW5nQ2xpZW50IGZyb20gJy4vdHJhZGluZy5jbGllbnQnO1xuXG5jb25zdCBjb3B5RmFjdG9yeUFwaVVybCA9ICdodHRwczovL3RyYWRpbmctYXBpLXYxLmFnaWxpdW10cmFkZS5hZ2lsaXVtdHJhZGUuYWknO1xuXG4vKipcbiAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50fVxuICovXG5kZXNjcmliZSgnVHJhZGluZ0NsaWVudCcsICgpID0+IHtcblxuICBsZXQgdHJhZGluZ0NsaWVudDtcbiAgY29uc3QgdG9rZW4gPSAnaGVhZGVyLnBheWxvYWQuc2lnbic7XG4gIGxldCBodHRwQ2xpZW50ID0gbmV3IEh0dHBDbGllbnQoKTtcbiAgbGV0IHNhbmRib3g7XG4gIGxldCByZXF1ZXN0U3R1YjtcblxuICBiZWZvcmUoKCkgPT4ge1xuICAgIHNhbmRib3ggPSBzaW5vbi5jcmVhdGVTYW5kYm94KCk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHRyYWRpbmdDbGllbnQgPSBuZXcgVHJhZGluZ0NsaWVudChodHRwQ2xpZW50LCB0b2tlbik7XG4gICAgcmVxdWVzdFN0dWIgPSBzYW5kYm94LnN0dWIoaHR0cENsaWVudCwgJ3JlcXVlc3QnKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I3Jlc3luY2hyb25pemV9XG4gICAqL1xuICBpdCgnc2hvdWxkIHJlc3luY2hyb25pemUgQ29weUZhY3RvcnkgYWNjb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCB0cmFkaW5nQ2xpZW50LnJlc3luY2hyb25pemUoJzAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYnLCBbJ0FCQ0QnXSk7XG4gICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2VXaXRoRXhhY3RseShodHRwQ2xpZW50LnJlcXVlc3QsIHtcbiAgICAgIHVybDogYCR7Y29weUZhY3RvcnlBcGlVcmx9L3VzZXJzL2N1cnJlbnQvYWNjb3VudHMvYCArXG4gICAgICAgICAgICAgICcwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmL3Jlc3luY2hyb25pemUnLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdG9rZW5cbiAgICAgIH0sXG4gICAgICBqc29uOiB0cnVlLFxuICAgICAgcXM6IHtcbiAgICAgICAgc3RyYXRlZ3lJZDogWydBQkNEJ11cbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I3Jlc3luY2hyb25pemV9XG4gICAqL1xuICBpdCgnc2hvdWxkIG5vdCByZXN5bmNocm9uaXplIGFjY291bnQgd2l0aCBhY2NvdW50IHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgIHRyYWRpbmdDbGllbnQgPSBuZXcgVHJhZGluZ0NsaWVudChodHRwQ2xpZW50LCAndG9rZW4nKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdHJhZGluZ0NsaWVudC5yZXN5bmNocm9uaXplKCcwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9yLm1lc3NhZ2Uuc2hvdWxkLmVxdWFsKFxuICAgICAgICAnWW91IGNhbiBub3QgaW52b2tlIHJlc3luY2hyb25pemUgbWV0aG9kLCBiZWNhdXNlIHlvdSBoYXZlIGNvbm5lY3RlZCB3aXRoIGFjY291bnQgYWNjZXNzIHRva2VuLiAnICtcbiAgICAgICAgJ1BsZWFzZSB1c2UgQVBJIGFjY2VzcyB0b2tlbiBmcm9tIGh0dHBzOi8vYXBwLm1ldGFhcGkuY2xvdWQvdG9rZW4gcGFnZSB0byBpbnZva2UgdGhpcyBtZXRob2QuJ1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7VHJhZGluZ0NsaWVudCNnZXRTdG9wb3V0c31cbiAgICovXG4gIGl0KCdzaG91bGQgcmV0cmlldmUgc3RvcG91dHMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4cGVjdGVkID0gW3tcbiAgICAgIHJlYXNvbjogJ21heC1kcmF3ZG93bicsXG4gICAgICBzdG9wcGVkQXQ6IG5ldyBEYXRlKCcyMDIwLTA4LTA4VDA3OjU3OjMwLjMyOFonKSxcbiAgICAgIHN0cmF0ZWd5OiB7XG4gICAgICAgIGlkOiAnQUJDRCcsXG4gICAgICAgIG5hbWU6ICdTdHJhdGVneSdcbiAgICAgIH0sXG4gICAgICByZWFzb25EZXNjcmlwdGlvbjogJ3RvdGFsIHN0cmF0ZWd5IGVxdWl0eSBkcmF3ZG93biBleGNlZWRlZCBsaW1pdCdcbiAgICB9XG4gICAgXTtcbiAgICByZXF1ZXN0U3R1Yi5yZXNvbHZlcyhleHBlY3RlZCk7XG4gICAgbGV0IHN0b3BvdXRzID0gYXdhaXQgdHJhZGluZ0NsaWVudFxuICAgICAgLmdldFN0b3BvdXRzKCcwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmJyk7XG4gICAgc3RvcG91dHMuc2hvdWxkLmVxdWFsKGV4cGVjdGVkKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZVdpdGhFeGFjdGx5KGh0dHBDbGllbnQucmVxdWVzdCwge1xuICAgICAgdXJsOiBgJHtjb3B5RmFjdG9yeUFwaVVybH0vdXNlcnMvY3VycmVudC9hY2NvdW50cy9gICtcbiAgICAgICAgICAgICAgJzAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYvc3RvcG91dHMnLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWUsXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7VHJhZGluZ0NsaWVudCNnZXRTdG9wb3V0c31cbiAgICovXG4gIGl0KCdzaG91bGQgbm90IHJldHJpZXZlIHN0b3BvdXRzIGZyb20gQVBJIHdpdGggYWNjb3VudCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICB0cmFkaW5nQ2xpZW50ID0gbmV3IFRyYWRpbmdDbGllbnQoaHR0cENsaWVudCwgJ3Rva2VuJyk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRyYWRpbmdDbGllbnQuZ2V0U3RvcG91dHMoJzAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYnKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZXJyb3IubWVzc2FnZS5zaG91bGQuZXF1YWwoXG4gICAgICAgICdZb3UgY2FuIG5vdCBpbnZva2UgZ2V0U3RvcG91dHMgbWV0aG9kLCBiZWNhdXNlIHlvdSBoYXZlIGNvbm5lY3RlZCB3aXRoIGFjY291bnQgYWNjZXNzIHRva2VuLiAnICtcbiAgICAgICAgJ1BsZWFzZSB1c2UgQVBJIGFjY2VzcyB0b2tlbiBmcm9tIGh0dHBzOi8vYXBwLm1ldGFhcGkuY2xvdWQvdG9rZW4gcGFnZSB0byBpbnZva2UgdGhpcyBtZXRob2QuJ1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAdGVzdCB7VHJhZGluZ0NsaWVudCNyZXNldFN0b3BvdXRzfVxuICAgKi9cbiAgaXQoJ3Nob3VsZCByZXNldCBzdG9wb3V0cycsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCB0cmFkaW5nQ2xpZW50LnJlc2V0U3RvcG91dHMoJzAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYnLFxuICAgICAgJ0FCQ0QnLCAnZGFpbHktZXF1aXR5Jyk7XG4gICAgc2lub24uYXNzZXJ0LmNhbGxlZE9uY2VXaXRoRXhhY3RseShodHRwQ2xpZW50LnJlcXVlc3QsIHtcbiAgICAgIHVybDogYCR7Y29weUZhY3RvcnlBcGlVcmx9L3VzZXJzL2N1cnJlbnQvYWNjb3VudHMvYCArXG4gICAgICAgICAgICAgICcwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmL3N0cmF0ZWdpZXMtc3Vic2NyaWJlZC8nICtcbiAgICAgICAgICAgICAgJ0FCQ0Qvc3RvcG91dHMvZGFpbHktZXF1aXR5L3Jlc2V0JyxcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I3Jlc2V0U3RvcG91dHN9XG4gICAqL1xuICBpdCgnc2hvdWxkIG5vdCByZXNldCBzdG9wb3V0cyB3aXRoIGFjY291bnQgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgdHJhZGluZ0NsaWVudCA9IG5ldyBUcmFkaW5nQ2xpZW50KGh0dHBDbGllbnQsICd0b2tlbicpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0cmFkaW5nQ2xpZW50LnJlc2V0U3RvcG91dHMoJzAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYnLFxuICAgICAgICAnQUJDRCcsICdkYWlseS1lcXVpdHknKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZXJyb3IubWVzc2FnZS5zaG91bGQuZXF1YWwoXG4gICAgICAgICdZb3UgY2FuIG5vdCBpbnZva2UgcmVzZXRTdG9wb3V0cyBtZXRob2QsIGJlY2F1c2UgeW91IGhhdmUgY29ubmVjdGVkIHdpdGggYWNjb3VudCBhY2Nlc3MgdG9rZW4uICcgK1xuICAgICAgICAnUGxlYXNlIHVzZSBBUEkgYWNjZXNzIHRva2VuIGZyb20gaHR0cHM6Ly9hcHAubWV0YWFwaS5jbG91ZC90b2tlbiBwYWdlIHRvIGludm9rZSB0aGlzIG1ldGhvZC4nXG4gICAgICApO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2dldFVzZXJMb2d9XG4gICAqL1xuICBpdCgnc2hvdWxkIHJldHJpZXZlIGNvcHkgdHJhZGluZyB1c2VyIGxvZycsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZXhwZWN0ZWQgPSBbe1xuICAgICAgdGltZTogbmV3IERhdGUoJzIwMjAtMDgtMDhUMDc6NTc6MzAuMzI4WicpLFxuICAgICAgbGV2ZWw6ICdJTkZPJyxcbiAgICAgIG1lc3NhZ2U6ICdtZXNzYWdlJ1xuICAgIH1dO1xuICAgIHJlcXVlc3RTdHViLnJlc29sdmVzKGV4cGVjdGVkKTtcbiAgICBsZXQgcmVjb3JkcyA9IGF3YWl0IHRyYWRpbmdDbGllbnRcbiAgICAgIC5nZXRVc2VyTG9nKCcwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmJyxcbiAgICAgICAgbmV3IERhdGUoJzIwMjAtMDgtMDFUMDA6MDA6MDAuMDAwWicpLCBuZXcgRGF0ZSgnMjAyMC0wOC0xMFQwMDowMDowMC4wMDBaJyksIDEwLCAxMDApO1xuICAgIHJlY29yZHMuc2hvdWxkLmVxdWFsKGV4cGVjdGVkKTtcbiAgICBzaW5vbi5hc3NlcnQuY2FsbGVkT25jZVdpdGhFeGFjdGx5KGh0dHBDbGllbnQucmVxdWVzdCwge1xuICAgICAgdXJsOiBgJHtjb3B5RmFjdG9yeUFwaVVybH0vdXNlcnMvY3VycmVudC9hY2NvdW50cy9gICtcbiAgICAgICAgICAgICcwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmL3VzZXItbG9nJyxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBxczoge1xuICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCcyMDIwLTA4LTAxVDAwOjAwOjAwLjAwMFonKSxcbiAgICAgICAgZW5kVGltZTogbmV3IERhdGUoJzIwMjAtMDgtMTBUMDA6MDA6MDAuMDAwWicpLFxuICAgICAgICBvZmZzZXQ6IDEwLFxuICAgICAgICBsaW1pdDogMTAwXG4gICAgICB9LFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnYXV0aC10b2tlbic6IHRva2VuXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEB0ZXN0IHtUcmFkaW5nQ2xpZW50I2dldFVzZXJMb2d9XG4gICAqL1xuICBpdCgnc2hvdWxkIG5vdCByZXRyaWV2ZSBjb3B5IHRyYWRpbmcgdXNlciBsb2cgZnJvbSBBUEkgd2l0aCBhY2NvdW50IHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgIHRyYWRpbmdDbGllbnQgPSBuZXcgVHJhZGluZ0NsaWVudChodHRwQ2xpZW50LCAndG9rZW4nKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdHJhZGluZ0NsaWVudC5nZXRVc2VyTG9nKCcwMTIzNDU2Nzg5YWJjZGVmMDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYwMTIzNDU2Nzg5YWJjZGVmJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9yLm1lc3NhZ2Uuc2hvdWxkLmVxdWFsKFxuICAgICAgICAnWW91IGNhbiBub3QgaW52b2tlIGdldFVzZXJMb2cgbWV0aG9kLCBiZWNhdXNlIHlvdSBoYXZlIGNvbm5lY3RlZCB3aXRoIGFjY291bnQgYWNjZXNzIHRva2VuLiAnICtcbiAgICAgICAgJ1BsZWFzZSB1c2UgQVBJIGFjY2VzcyB0b2tlbiBmcm9tIGh0dHBzOi8vYXBwLm1ldGFhcGkuY2xvdWQvdG9rZW4gcGFnZSB0byBpbnZva2UgdGhpcyBtZXRob2QuJ1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG59KTtcbiJdfQ==